<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title><![CDATA[docker 容器入门（四）]]></title>
      <url>/2017/10/29/docker-begin-4/</url>
      <content type="html"><![CDATA[<h2 id="写在前面的话"><a href="#写在前面的话" class="headerlink" title="写在前面的话"></a>写在前面的话</h2><h3 id="每篇一句"><a href="#每篇一句" class="headerlink" title="每篇一句"></a>每篇一句</h3><p>桃李不言，下自成蹊。</p>
<h2 id="利用docker-compose-yml-构建整套可伸缩的服务"><a href="#利用docker-compose-yml-构建整套可伸缩的服务" class="headerlink" title="利用docker-compose.yml 构建整套可伸缩的服务"></a>利用docker-compose.yml 构建整套可伸缩的服务</h2><p>docker-compose.yml是一种YAML文件，定义了容器的一系列完整的行为。</p>
<h3 id="docker-compose-yml"><a href="#docker-compose-yml" class="headerlink" title="docker-compose.yml"></a>docker-compose.yml</h3><p>docker-compose.yml定义了如下步骤：</p>
<ul>
<li>从远程仓库拉取镜像</li>
<li>运行3个容器实例作为web服务，并限制每个容器运行10%CPU，50MB内存</li>
<li>将web容器的80端口映射到宿主机的8080端口</li>
<li>web容器通过webnet进行负载均衡</li>
<li>webnet使用默认的负载均衡overlay设置<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">version: "3"</div><div class="line">services:</div><div class="line">  web:</div><div class="line">    <span class="comment"># replace username/repo:tag with your name and image details</span></div><div class="line">   <span class="comment">#image: username/repo:tag</span></div><div class="line">    image: zakizqzhang/get-started:20171028</div><div class="line">    deploy:</div><div class="line">      replicas: 3</div><div class="line">      resources:</div><div class="line">        limits:</div><div class="line">          cpus: "0.1"</div><div class="line">          memory: 50M</div><div class="line">      restart_policy:</div><div class="line">        condition: on-failure</div><div class="line">    ports:</div><div class="line">      - "8080:80"</div><div class="line">    networks:</div><div class="line">      - webnet</div><div class="line">networks:</div><div class="line">  webnet:</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="运行web负载均衡服务"><a href="#运行web负载均衡服务" class="headerlink" title="运行web负载均衡服务"></a>运行web负载均衡服务</h3><h4 id="swarm初始化"><a href="#swarm初始化" class="headerlink" title="swarm初始化"></a>swarm初始化</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@localhost docker]<span class="comment"># docker swarm  init</span></div><div class="line">Swarm initialized: current node (qmjxu1mlwksrxfwyq1sgcerrw) is now a manager.</div><div class="line"></div><div class="line">To add a worker to this swarm, run the following <span class="built_in">command</span>:</div><div class="line"></div><div class="line">    docker swarm join --token SWMTKN-1-5rww1e0vi13ye8blfyt6oq6nzd3cbfxlc22f3xt1ga93g6apjr-0pgu4dk6fkq3nw7kuu5urzp4k 10.254.36.124:2377</div><div class="line"></div><div class="line">To add a manager to this swarm, run <span class="string">'docker swarm join-token manager'</span> and follow the instructions.</div></pre></td></tr></table></figure>
<p>假设有第2台宿主机要加入只需运行,刚初始化的第一台默认为manager<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker swarm join --token SWMTKN-1-5rww1e0vi13ye8blfyt6oq6nzd3cbfxlc22f3xt1ga93g6apjr-0pgu4dk6fkq3nw7kuu5urzp4k 10.254.36.124:2377</div></pre></td></tr></table></figure></p>
<h4 id="web服务运行"><a href="#web服务运行" class="headerlink" title="web服务运行"></a>web服务运行</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@localhost docker]<span class="comment"># docker stack deploy  -c docker-compose.yml  testapp</span></div><div class="line">Creating network testapp_webnet</div><div class="line">Creating service testapp_web</div><div class="line">[root@localhost docker]<span class="comment"># netstat -tlunp |grep 8080</span></div><div class="line">tcp6       0      0 :::8080                 :::*                    LISTEN      4013/dockerd        </div><div class="line">[root@localhost docker]<span class="comment"># docker service ls</span></div><div class="line">ID                  NAME                MODE                REPLICAS            IMAGE                              PORTS</div><div class="line">0qbok4qrbv13        testapp_web         replicated          3/3</div></pre></td></tr></table></figure>
<h4 id="验证运行了3个容器"><a href="#验证运行了3个容器" class="headerlink" title="验证运行了3个容器"></a>验证运行了3个容器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@localhost docker]<span class="comment"># docker ps</span></div><div class="line">CONTAINER ID        IMAGE                              COMMAND             CREATED             STATUS              PORTS               NAMES</div><div class="line">a16ea7161064        zakizqzhang/get-started:20171028   <span class="string">"python app.py"</span>     33 seconds ago      Up 32 seconds       80/tcp              testapp_web.1.caohbftrljwcd5r2oh1c4l4rj</div><div class="line">52d904f5aedd        zakizqzhang/get-started:20171028   <span class="string">"python app.py"</span>     34 seconds ago      Up 33 seconds       80/tcp              testapp_web.2.viroif27tho9kyl4u7joko9tw</div><div class="line">62f6ea377033        zakizqzhang/get-started:20171028   <span class="string">"python app.py"</span>     37 seconds ago      Up 36 seconds       80/tcp              testapp_web.3.7au0dpwv8tdh1t9of1fcstqt6</div></pre></td></tr></table></figure>
<h4 id="浏览器访问，默认轮询方式负载到后端容器"><a href="#浏览器访问，默认轮询方式负载到后端容器" class="headerlink" title="浏览器访问，默认轮询方式负载到后端容器"></a>浏览器访问，默认轮询方式负载到后端容器</h4><p><img src="http://oy2fglccv.bkt.clouddn.com/coompose-helloworld.png" alt=""></p>
<h3 id="查看testapp运行的容器"><a href="#查看testapp运行的容器" class="headerlink" title="查看testapp运行的容器"></a>查看testapp运行的容器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@localhost docker]<span class="comment"># docker service ps testapp</span></div><div class="line">ID                  NAME                IMAGE                              NODE                    DESIRED STATE       CURRENT STATE            ERROR               PORTS</div><div class="line">caohbftrljwc        testapp_web.1       zakizqzhang/get-started:20171028   localhost.localdomain   Running             Running 11 minutes ago                       </div><div class="line">viroif27tho9        testapp_web.2       zakizqzhang/get-started:20171028   localhost.localdomain   Running             Running 11 minutes ago                       </div><div class="line">7au0dpwv8tdh        testapp_web.3       zakizqzhang/get-started:20171028   localhost.localdomain   Running             Running 11 minutes ago</div></pre></td></tr></table></figure>
<h3 id="扩容成5个容器-运行testapp-web服务"><a href="#扩容成5个容器-运行testapp-web服务" class="headerlink" title="扩容成5个容器,运行testapp web服务"></a>扩容成5个容器,运行testapp web服务</h3><p>将replicas 后面3改成5,重新deploy,docker stack rm 关闭testapp应用。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">[root@localhost docker]<span class="comment"># docker container  ls -q</span></div><div class="line">fce3c2f3d922</div><div class="line">9d73cdd1b15a</div><div class="line">9b5234fd0ac2</div><div class="line">[root@localhost docker]<span class="comment"># docker stack  ls</span></div><div class="line">NAME                SERVICES</div><div class="line">testapp             1</div><div class="line">[root@localhost docker]<span class="comment"># docker stack rm testapp</span></div><div class="line">Removing service testapp_web</div><div class="line">Removing network testapp_webnet</div><div class="line">[root@localhost docker]<span class="comment"># vi docker-compose.yml </span></div><div class="line">[root@localhost docker]<span class="comment"># docker stack deploy  -c docker-compose.yml  testapp</span></div><div class="line">Creating network testapp_webnet</div><div class="line">Creating service testapp_web</div><div class="line">[root@localhost docker]<span class="comment"># docker service ps testapp</span></div><div class="line">ID                  NAME                IMAGE                              NODE                    DESIRED STATE       CURRENT STATE            ERROR               PORTS</div><div class="line">i423v1euglfh        testapp_web.1       zakizqzhang/get-started:20171028   localhost.localdomain   Running             Running 29 seconds ago                       </div><div class="line">r4nsghgl6sv3        testapp_web.2       zakizqzhang/get-started:20171028   localhost.localdomain   Running             Running 29 seconds ago                       </div><div class="line">rlrtevdw49df        testapp_web.3       zakizqzhang/get-started:20171028   localhost.localdomain   Running             Running 29 seconds ago                       </div><div class="line">jhcaukbhyrv3        testapp_web.4       zakizqzhang/get-started:20171028   localhost.localdomain   Running             Running 29 seconds ago                       </div><div class="line">lc3jhwhrugn3        testapp_web.5       zakizqzhang/get-started:20171028   localhost.localdomain   Running             Running 29 seconds ago</div></pre></td></tr></table></figure></p>
<h2 id="swarms集群"><a href="#swarms集群" class="headerlink" title="swarms集群"></a>swarms集群</h2><p>上面虽然实现了负载均衡，但是5个容器都运行在一台host上，下面我们通过swarms集群将testapp应用运行在2台host上。<br>刚刚第一台主机ip为：10.254.36.124<br>第二天主机ip 为10.254.36.42</p>
<h3 id="10-254-36-42-加入swarms集群"><a href="#10-254-36-42-加入swarms集群" class="headerlink" title="10.254.36.42 加入swarms集群"></a>10.254.36.42 加入swarms集群</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">root@ubuntu:~<span class="comment"># docker swarm join --token SWMTKN-1-5rww1e0vi13ye8blfyt6oq6nzd3cbfxlc22f3xt1ga93g6apjr-0pgu4dk6fkq3nw7kuu5urzp4k 10.254.36.124:2377</span></div><div class="line">This node joined a swarm as a worker.</div></pre></td></tr></table></figure>
<h3 id="查看目前加入的节点情况"><a href="#查看目前加入的节点情况" class="headerlink" title="查看目前加入的节点情况"></a>查看目前加入的节点情况</h3><p>在第一台manager上运行，后加入的worker节点查看不了。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@localhost docker]<span class="comment"># docker node  ls</span></div><div class="line">ID                            HOSTNAME                STATUS              AVAILABILITY        MANAGER STATUS</div><div class="line">gtb0ip6zpu4hazqg4bgp5z19m     ubuntu                  Ready               Active              </div><div class="line">qmjxu1mlwksrxfwyq1sgcerrw *   localhost.localdomain   Ready               Active              Leader</div></pre></td></tr></table></figure></p>
<h3 id="重新运行-注意要在第二台机器先拉取镜像，不然运行失败。"><a href="#重新运行-注意要在第二台机器先拉取镜像，不然运行失败。" class="headerlink" title="重新运行,注意要在第二台机器先拉取镜像，不然运行失败。"></a>重新运行,注意要在第二台机器先拉取镜像，不然运行失败。</h3><p>10.254.36.42<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">root@ubuntu:~<span class="comment"># docker pull zakizqzhang/get-started:20171028 </span></div><div class="line">20171028: Pulling from zakizqzhang/get-started</div><div class="line">85b1f47fba49: Pull complete </div><div class="line">a5e401c4a903: Pull complete </div><div class="line">9f744658dd62: Pull complete </div><div class="line">562843cc69f8: Pull complete </div><div class="line">361ab7a9bb73: Pull complete </div><div class="line">72c3035db3bc: Pull complete </div><div class="line">68e97c9c12b4: Pull complete </div><div class="line">Digest: sha256:208754af6f21fc4a14eacc22b2734f490cb3c3a495c7595a74a79529f68429ee</div><div class="line">Status: Downloaded newer image <span class="keyword">for</span> zakizqzhang/get-started:20171028</div></pre></td></tr></table></figure></p>
<p>10.254.36.124<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[root@localhost docker]<span class="comment"># docker stack rm  testapp </span></div><div class="line">Removing service testapp_web</div><div class="line">Removing network testapp_webnet</div><div class="line">[root@localhost docker]<span class="comment"># docker stack deploy  -c docker-compose.yml  testapp</span></div><div class="line">Creating network testapp_webnet</div><div class="line">Creating service testapp_web</div><div class="line">[root@localhost docker]<span class="comment"># docker stack  ps testapp</span></div><div class="line">ID                  NAME                IMAGE                              NODE                    DESIRED STATE       CURRENT STATE            ERROR               PORTS</div><div class="line">2pybph62tyfd        testapp_web.1       zakizqzhang/get-started:20171028   ubuntu                  Running             Running 5 seconds ago                        </div><div class="line">36gqfjvz23zw        testapp_web.2       zakizqzhang/get-started:20171028   localhost.localdomain   Running             Running 29 seconds ago                       </div><div class="line">r35bc1sihxre        testapp_web.3       zakizqzhang/get-started:20171028   ubuntu                  Running             Running 2 seconds ago                        </div><div class="line">nt00z4ykjhrm        testapp_web.4       zakizqzhang/get-started:20171028   localhost.localdomain   Running             Running 28 seconds ago                       </div><div class="line">09d742ecerbp        testapp_web.5       zakizqzhang/get-started:20171028   ubuntu                  Running             Running 3 seconds ago</div></pre></td></tr></table></figure></p>
<p>到现在testapp应用的web服务，高可用就妥妥的了，随便一台host宕机，不会影响对外服务。</p>
]]></content>
      
        <categories>
            
            <category> 技术 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> docker </tag>
            
            <tag> 容器 </tag>
            
            <tag> centos7 </tag>
            
            <tag> 云平台技术 </tag>
            
            <tag> swarms </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[docker 容器入门（三）]]></title>
      <url>/2017/10/28/docker-begin-3/</url>
      <content type="html"><![CDATA[<h2 id="写在前面的话"><a href="#写在前面的话" class="headerlink" title="写在前面的话"></a>写在前面的话</h2><h3 id="每篇一句"><a href="#每篇一句" class="headerlink" title="每篇一句"></a>每篇一句</h3><p>板凳要坐十年冷；文章不写半句空。</p>
<p>上篇通过dockerfile已经构建了自己的镜像，那如何将镜像分享到自己的仓库呢？</p>
<p>首先注册docker hub账号<a href="https://hub.docker.com" target="_blank" rel="external">官网地址</a></p>
<h2 id="构建你的容器仓库，分享你的镜像"><a href="#构建你的容器仓库，分享你的镜像" class="headerlink" title="构建你的容器仓库，分享你的镜像"></a>构建你的容器仓库，分享你的镜像</h2><h3 id="通过docker-ID登录"><a href="#通过docker-ID登录" class="headerlink" title="通过docker ID登录"></a>通过docker ID登录</h3><p>我的用户名是zakizqzhang<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># docker login</span></div><div class="line">Login with your Docker ID to push and pull images from Docker Hub. If you don<span class="string">'t have a Docker ID, head over to https://hub.docker.com to create one.</span></div><div class="line"><span class="string">Username: zakizqzhang</span></div><div class="line"><span class="string">Password: </span></div><div class="line"><span class="string">Login Succeeded</span></div></pre></td></tr></table></figure></p>
<h3 id="给你的镜像打上标签"><a href="#给你的镜像打上标签" class="headerlink" title="给你的镜像打上标签"></a>给你的镜像打上标签</h3><p>通常是username/repository:tag来定义你的一个镜像，tag选项是可选的，但是推荐使用来让其他人明白，最好使用有意义的命名，比如dockerfiletestapp:v1.0,v1.0就是标签，明确知道是第1.0版本，或者使用<br>dockerfiletestapp:20171028，明确知道是2017年10月28号构建的镜像。</p>
<p>命令语法<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker tag image username/repository:tag</div></pre></td></tr></table></figure></p>
<h4 id="查看本地有哪些镜像"><a href="#查看本地有哪些镜像" class="headerlink" title="查看本地有哪些镜像"></a>查看本地有哪些镜像</h4><p>其中dockerfiletestapp就是上次我们用dockerfile构建的镜像<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># docker images</span></div><div class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</div><div class="line">dockerfiletestapp   latest              6410ee31b207        6 days ago          195MB</div><div class="line">python              2.7-slim            9724e90f1f17        2 weeks ago         184MB</div><div class="line">hello-world         latest              05a3bd381fc2        6 weeks ago         1.84kB</div></pre></td></tr></table></figure></p>
<h4 id="给dockerfiletestapp-镜像打上标签"><a href="#给dockerfiletestapp-镜像打上标签" class="headerlink" title="给dockerfiletestapp 镜像打上标签"></a>给dockerfiletestapp 镜像打上标签</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># docker tag dockerfiletestapp  zakizqzhang/get-started:20171028</span></div><div class="line">[root@localhost ~]<span class="comment"># docker images</span></div><div class="line">REPOSITORY                TAG                 IMAGE ID            CREATED             SIZE</div><div class="line">dockerfiletestapp         latest              6410ee31b207        6 days ago          195MB</div><div class="line">zakizqzhang/get-started   20171028            6410ee31b207        6 days ago          195MB</div><div class="line">python                    2.7-slim            9724e90f1f17        2 weeks ago         184MB</div><div class="line">hello-world               latest              05a3bd381fc2        6 weeks ago         1.84kB</div></pre></td></tr></table></figure>
<h3 id="push-发布上传镜像"><a href="#push-发布上传镜像" class="headerlink" title="push 发布上传镜像"></a>push 发布上传镜像</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># docker push  zakizqzhang/get-started:20171028</span></div><div class="line">The push refers to a repository [docker.io/zakizqzhang/get-started]</div><div class="line">71fedff88b96: Pushed </div><div class="line">1f3b097ea1a5: Pushed </div><div class="line">3a3e7e444f5d: Pushed </div><div class="line">f39f8a7b1485: Mounted from library/python </div><div class="line">5e4d4a29edae: Mounted from library/python </div><div class="line">f46f014db30a: Mounted from library/python </div><div class="line">c01c63c6823d: Mounted from library/python </div><div class="line">20171028: digest: sha256:208754af6f21fc4a14eacc22b2734f490cb3c3a495c7595a74a79529f68429ee size: 1787</div></pre></td></tr></table></figure>
<h3 id="在任何一台联网装有docker引擎的机器上拉取并运行远程仓库镜像"><a href="#在任何一台联网装有docker引擎的机器上拉取并运行远程仓库镜像" class="headerlink" title="在任何一台联网装有docker引擎的机器上拉取并运行远程仓库镜像"></a>在任何一台联网装有docker引擎的机器上拉取并运行远程仓库镜像</h3><p>这里为了方便，先将本地dockerfiletestapp镜像删除。注意删除镜像的前置条件是先删除通过该镜像运行过的容器方可删除镜像。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># docker image rm zakizqzhang/get-started:20171028</span></div><div class="line">Untagged: zakizqzhang/get-started:20171028</div><div class="line">Untagged: zakizqzhang/get-started@sha256:208754af6f21fc4a14eacc22b2734f490cb3c3a495c7595a74a79529f68429ee</div><div class="line">[root@localhost ~]<span class="comment"># docker image rm dockerfiletestapp</span></div><div class="line">Error response from daemon: conflict: unable to remove repository reference <span class="string">"dockerfiletestapp"</span> (must force) - container 00616249b739 is using its referenced image 6410ee31b207</div><div class="line">[root@localhost ~]<span class="comment"># docker ps --all</span></div><div class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                      PORTS                  NAMES</div><div class="line">032f18cd82ef        6410ee31b207        <span class="string">"python app.py"</span>     2 minutes ago       Exited (0) 54 seconds ago                          flamboyant_lamport</div><div class="line">f5295eca69d8        dockerfiletestapp   <span class="string">"python app.py"</span>     6 days ago          Exited (255) 6 days ago     0.0.0.0:8080-&gt;80/tcp   optimistic_goldberg</div><div class="line">bf03b99b65fc        dockerfiletestapp   <span class="string">"python app.py"</span>     6 days ago          Exited (0) 6 days ago                              romantic_knuth</div><div class="line">00616249b739        dockerfiletestapp   <span class="string">"python app.py"</span>     6 days ago          Exited (0) 6 days ago                              priceless_stonebraker</div><div class="line">e892562d1fa4        hello-world         <span class="string">"/hello"</span>            6 days ago          Exited (0) 6 days ago                              determined_raman</div><div class="line">[root@localhost ~]<span class="comment"># docker rm 00616249b739 bf03b99b65fc f5295eca69d8</span></div><div class="line">00616249b739</div><div class="line">bf03b99b65fc</div><div class="line">f5295eca69d8</div><div class="line">[root@localhost ~]<span class="comment"># docker image rm dockerfiletestapp</span></div><div class="line">Error response from daemon: conflict: unable to remove repository reference <span class="string">"dockerfiletestapp"</span> (must force) - container 032f18cd82ef is using its referenced image 6410ee31b207</div><div class="line">[root@localhost ~]<span class="comment"># docker ps --all</span></div><div class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                     PORTS               NAMES</div><div class="line">032f18cd82ef        6410ee31b207        <span class="string">"python app.py"</span>     3 minutes ago       Exited (0) 2 minutes ago                       flamboyant_lamport</div><div class="line">e892562d1fa4        hello-world         <span class="string">"/hello"</span>            6 days ago          Exited (0) 6 days ago                          determined_raman</div><div class="line">[root@localhost ~]<span class="comment"># docker rm 032f18cd82ef </span></div><div class="line">032f18cd82ef</div><div class="line">[root@localhost ~]<span class="comment"># docker image rm dockerfiletestapp</span></div><div class="line">Untagged: dockerfiletestapp:latest</div><div class="line">Deleted: sha256:6410ee31b207d3cdf8120c69b27de0abf3962e6a06eb339410ba1ca4c51b46f5</div><div class="line">Deleted: sha256:c3639bed347aae90e7d81e047384249ff3969725ded6ae9e8aca225a1f734d31</div><div class="line">Deleted: sha256:dd270ef27c690dc6491ae844f54bc85a5cffadc4206779a8be48cf93eae0becc</div><div class="line">Deleted: sha256:9956c6e6c7c952fcde7b61d98aec4e5b545ec2a9608c0f9def397ba46ba33a59</div><div class="line">Deleted: sha256:0ca8e4dc2aa04cfc28294e9679dac0e41b0941ea5decad36dacc68549269760e</div><div class="line">Deleted: sha256:046356d78b97a7d14e4bfe360218a0068005eeca0a2931418bc5f3a308367268</div><div class="line">Deleted: sha256:3400ce1c487e9213c6be4c6ade646eebbc64bae8666151a208d3179fb04581b4</div><div class="line">Deleted: sha256:40fcd39ff30a1569a680fa8ddb9968b7062e0e6f32a58416877e76338e7b0734</div><div class="line">Deleted: sha256:e7d7f9d762c90de03b48c583a5304626df173ba2a0e2c6387110f87af7e5d809</div><div class="line">[root@localhost ~]<span class="comment"># docker images</span></div><div class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</div><div class="line">python              2.7-slim            9724e90f1f17        2 weeks ago         184MB</div><div class="line">hello-world         latest              05a3bd381fc2        6 weeks ago         1.84kB</div></pre></td></tr></table></figure></p>
<p>通过拉取远程仓库镜像本地运行容器<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># docker run -p 8080:80  zakizqzhang/get-started:20171028</span></div><div class="line">Unable to find image <span class="string">'zakizqzhang/get-started:20171028'</span> locally</div><div class="line">20171028: Pulling from zakizqzhang/get-started</div><div class="line">85b1f47fba49: Already exists </div><div class="line">a5e401c4a903: Already exists </div><div class="line">9f744658dd62: Already exists </div><div class="line">562843cc69f8: Already exists </div><div class="line">361ab7a9bb73: Pull complete </div><div class="line">72c3035db3bc: Pull complete </div><div class="line">68e97c9c12b4: Pull complete </div><div class="line">Digest: sha256:208754af6f21fc4a14eacc22b2734f490cb3c3a495c7595a74a79529f68429ee</div><div class="line">Status: Downloaded newer image <span class="keyword">for</span> zakizqzhang/get-started:20171028</div><div class="line"> * Running on http://0.0.0.0:80/ (Press CTRL+C to quit)</div></pre></td></tr></table></figure></p>
<p>运行的容器所需的python、flask、redis、应用脚本app.py等依赖全部不用你再考虑了，实现了一次构建，随处运行。</p>
]]></content>
      
        <categories>
            
            <category> 技术 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> docker </tag>
            
            <tag> 容器 </tag>
            
            <tag> centos7 </tag>
            
            <tag> 云平台技术 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[docker 容器入门（二）]]></title>
      <url>/2017/10/24/docker-begin-2/</url>
      <content type="html"><![CDATA[<h2 id="写在前面的话"><a href="#写在前面的话" class="headerlink" title="写在前面的话"></a>写在前面的话</h2><h3 id="每篇一句"><a href="#每篇一句" class="headerlink" title="每篇一句"></a>每篇一句</h3><p>书到用时方恨少，事非经过不知难。</p>
<h2 id="通过dockerfile配置文件定义运行容器"><a href="#通过dockerfile配置文件定义运行容器" class="headerlink" title="通过dockerfile配置文件定义运行容器"></a>通过dockerfile配置文件定义运行容器</h2><p>你可以将容器内部运行所依赖的所有资源和步骤定义在的Dockerfile文件中</p>
<h3 id="Dockerfile-例子"><a href="#Dockerfile-例子" class="headerlink" title="Dockerfile 例子"></a>Dockerfile 例子</h3><h4 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@localhost docker]<span class="comment"># tree</span></div><div class="line">.</div><div class="line">└── app</div><div class="line">    ├── app.py</div><div class="line">    ├── Dockerfile</div><div class="line">    └── requirements.txt</div><div class="line"></div><div class="line">1 directory, 3 files</div></pre></td></tr></table></figure>
<h4 id="Dockerfile-内容"><a href="#Dockerfile-内容" class="headerlink" title="Dockerfile 内容"></a>Dockerfile 内容</h4><p>以#号开头的行都是注释，为每个命令行写注释是个好习惯，方便别人了解每个步骤功能。<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Use an official Python runtime as a parent image</span></div><div class="line">FROM python:2.7-slim</div><div class="line"></div><div class="line"><span class="comment"># Set the working directory to /app</span></div><div class="line">WORKDIR /app</div><div class="line"></div><div class="line"><span class="comment"># Copy the current directory contents into the container at /app</span></div><div class="line">ADD . /app</div><div class="line"></div><div class="line"><span class="comment"># Install any needed packages specified in requirements.txt</span></div><div class="line">RUN pip install -r requirements.txt</div><div class="line"></div><div class="line"><span class="comment"># Make port 80 available to the world outside this container</span></div><div class="line">EXPOSE 80</div><div class="line"></div><div class="line"><span class="comment"># Define environment variable</span></div><div class="line">ENV NAME World</div><div class="line"></div><div class="line"><span class="comment"># Run app.py when the container launches</span></div><div class="line">CMD ["python", "app.py"]</div></pre></td></tr></table></figure></p>
<h4 id="requirements-txt-内容"><a href="#requirements-txt-内容" class="headerlink" title="requirements.txt 内容"></a>requirements.txt 内容</h4><p>定义了app.py python脚本所需的 flask（python轻量web框架）用来显示http页面，redis（缓存数据库）用来记录访客数量<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Flask</div><div class="line">Redis</div></pre></td></tr></table></figure></p>
<h4 id="app-py-内容"><a href="#app-py-内容" class="headerlink" title="app.py 内容"></a>app.py 内容</h4><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">from flask import Flask</div><div class="line">from redis import Redis, RedisError</div><div class="line">import os</div><div class="line">import socket</div><div class="line"></div><div class="line"><span class="comment"># Connect to Redis</span></div><div class="line"><span class="attr">redis</span> = Redis(host=<span class="string">"redis"</span>, db=<span class="number">0</span>, socket_connect_timeout=<span class="number">2</span>, socket_timeout=<span class="number">2</span>)</div><div class="line"></div><div class="line"><span class="attr">app</span> = Flask(__name__)</div><div class="line"></div><div class="line">@app.route("/")</div><div class="line">def hello():</div><div class="line">    try:</div><div class="line">        visits = redis.incr("counter")</div><div class="line">    except RedisError:</div><div class="line">        visits = "&lt;i&gt;cannot connect to Redis, counter disabled&lt;/i&gt;"</div><div class="line"></div><div class="line">    html = "&lt;h3&gt;Hello &#123;name&#125;!&lt;/h3&gt;" \</div><div class="line">           "&lt;b&gt;Hostname:&lt;/b&gt; &#123;hostname&#125;&lt;br/&gt;" \</div><div class="line">           "&lt;b&gt;Visits:&lt;/b&gt; &#123;visits&#125;"</div><div class="line">    return html.format(name=os.getenv("NAME", "world"), hostname=socket.gethostname(), visits=visits)</div><div class="line"></div><div class="line">if __name__ == "__main__":</div><div class="line">    app.run(host='0.0.0.0', port=80)</div></pre></td></tr></table></figure>
<h4 id="构建镜像"><a href="#构建镜像" class="headerlink" title="构建镜像"></a>构建镜像</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line">[root@localhost app]<span class="comment"># pwd</span></div><div class="line">/data/docker/app</div><div class="line">[root@localhost app]<span class="comment"># ls -l</span></div><div class="line">总用量 12</div><div class="line">-rw-r--r-- 1 root root 665 10月 22 16:40 app.py</div><div class="line">-rw-r--r-- 1 root root 481 10月 22 16:38 Dockerfile</div><div class="line">-rw-r--r-- 1 root root  12 10月 22 16:39 requirements.txt</div><div class="line">[root@localhost app]<span class="comment"># docker build -t dockerfiletestapp  .</span></div><div class="line">Sending build context to Docker daemon  4.608kB</div><div class="line">Step 1/7 : FROM python:2.7-slim</div><div class="line">2.7-slim: Pulling from library/python</div><div class="line">85b1f47fba49: Pull complete </div><div class="line">a5e401c4a903: Pull complete </div><div class="line">9f744658dd62: Pull complete </div><div class="line">562843cc69f8: Pull complete </div><div class="line">Digest: sha256:b614fcd205ffe3f8a993dd29cc74fac6399a70d07e0d20a07f4222e968b79466</div><div class="line">Status: Downloaded newer image <span class="keyword">for</span> python:2.7-slim</div><div class="line"> ---&gt; 9724e90f1f17</div><div class="line">Step 2/7 : WORKDIR /app</div><div class="line"> ---&gt; 40fcd39ff30a</div><div class="line">Removing intermediate container fee56dd2f3d7</div><div class="line">Step 3/7 : ADD . /app</div><div class="line"> ---&gt; 046356d78b97</div><div class="line">Removing intermediate container 71a0202d1eb3</div><div class="line">Step 4/7 : RUN pip install -r requirements.txt</div><div class="line"> ---&gt; Running <span class="keyword">in</span> fbd0773ab2c4</div><div class="line">Collecting Flask (from -r requirements.txt (line 1))</div><div class="line">  Downloading Flask-0.12.2-py2.py3-none-any.whl (83kB)</div><div class="line">Collecting Redis (from -r requirements.txt (line 2))</div><div class="line">  Downloading redis-2.10.6-py2.py3-none-any.whl (64kB)</div><div class="line">Collecting itsdangerous&gt;=0.21 (from Flask-&gt;-r requirements.txt (line 1))</div><div class="line">  Downloading itsdangerous-0.24.tar.gz (46kB)</div><div class="line">Collecting Jinja2&gt;=2.4 (from Flask-&gt;-r requirements.txt (line 1))</div><div class="line">  Downloading Jinja2-2.9.6-py2.py3-none-any.whl (340kB)</div><div class="line">Collecting Werkzeug&gt;=0.7 (from Flask-&gt;-r requirements.txt (line 1))</div><div class="line">  Downloading Werkzeug-0.12.2-py2.py3-none-any.whl (312kB)</div><div class="line">Collecting click&gt;=2.0 (from Flask-&gt;-r requirements.txt (line 1))</div><div class="line">  Downloading click-6.7-py2.py3-none-any.whl (71kB)</div><div class="line">Collecting MarkupSafe&gt;=0.23 (from Jinja2&gt;=2.4-&gt;Flask-&gt;-r requirements.txt (line 1))</div><div class="line">  Downloading MarkupSafe-1.0.tar.gz</div><div class="line">Building wheels <span class="keyword">for</span> collected packages: itsdangerous, MarkupSafe</div><div class="line">  Running setup.py bdist_wheel <span class="keyword">for</span> itsdangerous: started</div><div class="line">  Running setup.py bdist_wheel <span class="keyword">for</span> itsdangerous: finished with status <span class="string">'done'</span></div><div class="line">  Stored <span class="keyword">in</span> directory: /root/.cache/pip/wheels/<span class="built_in">fc</span>/a8/66/24d655233c757e178d45dea2de22a04c6d92766abfb741129a</div><div class="line">  Running setup.py bdist_wheel <span class="keyword">for</span> MarkupSafe: started</div><div class="line">  Running setup.py bdist_wheel <span class="keyword">for</span> MarkupSafe: finished with status <span class="string">'done'</span></div><div class="line">  Stored <span class="keyword">in</span> directory: /root/.cache/pip/wheels/88/a7/30/e39a54a87bcbe25308fa3ca64e8ddc75d9b3e5afa21ee32d57</div><div class="line">Successfully built itsdangerous MarkupSafe</div><div class="line">Installing collected packages: itsdangerous, MarkupSafe, Jinja2, Werkzeug, click, Flask, Redis</div><div class="line">Successfully installed Flask-0.12.2 Jinja2-2.9.6 MarkupSafe-1.0 Redis-2.10.6 Werkzeug-0.12.2 click-6.7 itsdangerous-0.24</div><div class="line"> ---&gt; 9956c6e6c7c9</div><div class="line">Removing intermediate container fbd0773ab2c4</div><div class="line">Step 5/7 : EXPOSE 80</div><div class="line"> ---&gt; Running <span class="keyword">in</span> 9d54cce05d2e</div><div class="line"> ---&gt; dd270ef27c69</div><div class="line">Removing intermediate container 9d54cce05d2e</div><div class="line">Step 6/7 : ENV NAME World</div><div class="line"> ---&gt; Running <span class="keyword">in</span> e80e94eeaf05</div><div class="line"> ---&gt; c3639bed347a</div><div class="line">Removing intermediate container e80e94eeaf05</div><div class="line">Step 7/7 : CMD python app.py</div><div class="line"> ---&gt; Running <span class="keyword">in</span> 6c6a47319e18</div><div class="line"> ---&gt; 6410ee31b207</div><div class="line">Removing intermediate container 6c6a47319e18</div><div class="line">Successfully built 6410ee31b207</div><div class="line">Successfully tagged dockerfiletestapp:latest</div></pre></td></tr></table></figure>
<p>docker image 可以查看到刚下载的python镜像和按照dockerfile构建的dockerfiletestapp<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@localhost app]<span class="comment"># docker images</span></div><div class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</div><div class="line">dockerfiletestapp   latest              6410ee31b207        2 minutes ago       195MB</div><div class="line">python              2.7-slim            9724e90f1f17        12 days ago         184MB</div><div class="line">hello-world         latest              05a3bd381fc2        5 weeks ago         1.84kB</div></pre></td></tr></table></figure></p>
<h4 id="前台运行容器"><a href="#前台运行容器" class="headerlink" title="前台运行容器"></a>前台运行容器</h4><p>-p 选项将容器内部端口80 映射到所在虚拟机的8080 端口<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@localhost app]<span class="comment"># docker run -p 8080:80 dockerfiletestapp</span></div><div class="line"> * Running on http://0.0.0.0:80/ (Press CTRL+C to quit)</div><div class="line">172.17.0.1 - - [22/Oct/2017 09:16:05] <span class="string">"GET / HTTP/1.1"</span> 200 -</div><div class="line">172.17.0.1 - - [22/Oct/2017 09:16:25] <span class="string">"GET / HTTP/1.1"</span> 200 -</div></pre></td></tr></table></figure></p>
<h4 id="通过浏览器访问-容器所在虚拟机ip-192-168-0-146-8080"><a href="#通过浏览器访问-容器所在虚拟机ip-192-168-0-146-8080" class="headerlink" title="通过浏览器访问 容器所在虚拟机ip 192.168.0.146:8080"></a>通过浏览器访问 容器所在虚拟机ip 192.168.0.146:8080</h4><p>虚拟机宿主机浏览器访问<br><img src="http://oy2fglccv.bkt.clouddn.com/helloworld.png" alt=""></p>
<p>虚拟机宿主机命令行访问<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">zakizqzhangdeMacBook-Pro:~ zakizqzhang$ curl http://192.168.0.146:8080</div><div class="line">&lt;h3&gt;Hello World!&lt;/h3&gt;&lt;b&gt;Hostname:&lt;/b&gt; f5295eca69d8&lt;br/&gt;&lt;b&gt;Visits:&lt;/b&gt; &lt;i&gt;cannot connect to Redis, counter disabled&lt;/i&gt;</div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">docker ps 查看当前运行容器ID  也就是上面容器呈现的页面的Hostname</div><div class="line">[root@localhost ~]<span class="comment"># docker ps</span></div><div class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS                  NAMES</div><div class="line">f5295eca69d8        dockerfiletestapp   <span class="string">"python app.py"</span>     26 minutes ago      Up 26 minutes       0.0.0.0:8080-&gt;80/tcp   optimistic_goldberg</div></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> 技术 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> docker </tag>
            
            <tag> 容器 </tag>
            
            <tag> centos7 </tag>
            
            <tag> 云平台技术 </tag>
            
            <tag> python </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[docker 容器入门（一）]]></title>
      <url>/2017/10/23/docker-begin-1/</url>
      <content type="html"><![CDATA[<h2 id="写在前面的话"><a href="#写在前面的话" class="headerlink" title="写在前面的话"></a>写在前面的话</h2><h3 id="每篇一句"><a href="#每篇一句" class="headerlink" title="每篇一句"></a>每篇一句</h3><p>岁寒，然后知松柏之后雕也。</p>
<h2 id="社区版容器安装，运行第一个容器"><a href="#社区版容器安装，运行第一个容器" class="headerlink" title="社区版容器安装，运行第一个容器"></a>社区版容器安装，运行第一个容器</h2><h3 id="环境介绍"><a href="#环境介绍" class="headerlink" title="环境介绍"></a>环境介绍</h3><p>os 内核版本不低于3，注意操作系统要是主要维护版本，没有EOL。<br>我常见到的容器所运行的os环境主要是Ubuntu 及Centos，下面以centos7为例。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@localhost yum.repos.d]<span class="comment"># uname -a</span></div><div class="line">Linux localhost.localdomain 3.10.0-514.el7.x86_64 <span class="comment">#1 SMP Tue Nov 22 16:42:41 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux</span></div><div class="line">[root@localhost yum.repos.d]<span class="comment"># cat /etc/redhat-release </span></div><div class="line">CentOS Linux release 7.3.1611 (Core)</div></pre></td></tr></table></figure>
<h3 id="镜像源配置"><a href="#镜像源配置" class="headerlink" title="镜像源配置"></a>镜像源配置</h3><p>使用国内的镜像源可以极大加速软件安装速度和成功率。</p>
<h4 id="配置操作系统基本软件和扩展软件源"><a href="#配置操作系统基本软件和扩展软件源" class="headerlink" title="配置操作系统基本软件和扩展软件源"></a>配置操作系统基本软件和扩展软件源</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># cd /etc/yum.repos.d/</span></div><div class="line">[root@localhost yum.repos.d]<span class="comment"># ls -l</span></div><div class="line">总用量 36</div><div class="line">-rw-r--r--. 1 root root 1664 11月 30 2016 CentOS-Base.repo</div><div class="line">-rw-r--r--. 1 root root 1309 11月 30 2016 CentOS-CR.repo</div><div class="line">-rw-r--r--. 1 root root  649 11月 30 2016 CentOS-Debuginfo.repo</div><div class="line">-rw-r--r--. 1 root root  314 11月 30 2016 CentOS-fasttrack.repo</div><div class="line">-rw-r--r--. 1 root root  630 11月 30 2016 CentOS-Media.repo</div><div class="line">-rw-r--r--. 1 root root 1331 11月 30 2016 CentOS-Sources.repo</div><div class="line">-rw-r--r--. 1 root root 2893 11月 30 2016 CentOS-Vault.repo</div><div class="line">-rw-r--r--  1 root root  957 12月 28 2016 epel.repo</div><div class="line">-rw-r--r--  1 root root 1056 12月 28 2016 epel-testing.repo</div><div class="line">[root@localhost yum.repos.d]<span class="comment"># mkdir repobak</span></div><div class="line">[root@localhost yum.repos.d]<span class="comment"># mv *.repo repobak/</span></div><div class="line">[root@localhost yum.repos.d]<span class="comment"># wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span></div><div class="line">[root@localhost yum.repos.d]<span class="comment"># wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span></div><div class="line">[root@localhost yum.repos.d]<span class="comment"># yum clean all</span></div><div class="line">已加载插件：fastestmirror, langpacks</div><div class="line">正在清理软件源： base epel extras updates</div><div class="line">Cleaning up everything</div><div class="line">Cleaning up list of fastest mirrors</div><div class="line">[root@localhost yum.repos.d]<span class="comment"># yum makecache</span></div><div class="line">已加载插件：fastestmirror, langpacks</div><div class="line">http://mirrors.aliyuncs.com/centos/7/os/x86_64/repodata/repomd.xml: [Errno 12] Timeout on http://mirrors.aliyuncs.com/centos/7/os/x86_64/repodata/repomd.xml: (28, <span class="string">'Connection timed out after 30001 milliseconds'</span>)</div><div class="line">正在尝试其它镜像。</div><div class="line">base                                                     | 3.6 kB     00:00     </div><div class="line">epel                                                     | 4.3 kB     00:00     </div><div class="line">extras                                                   | 3.4 kB     00:00     </div><div class="line">updates                                                  | 3.4 kB     00:00</div><div class="line">Determining fastest mirrors</div><div class="line"> * base: mirrors.aliyun.com</div><div class="line"> * epel: mirrors.aliyun.com</div><div class="line"> * extras: mirrors.aliyun.com</div><div class="line"> * updates: mirrors.aliyun.com</div><div class="line">元数据缓存已建立</div></pre></td></tr></table></figure>
<p>里面<a href="http://mirrors.aliyuncs.com/centos/7/os/x86_64/repodata/repomd.xml" target="_blank" rel="external">http://mirrors.aliyuncs.com/centos/7/os/x86_64/repodata/repomd.xml</a>: [Errno 12] Timeout on 原因是使用阿里云服务器，会优先从mirrors.aliyuncs.com,不占用云服务器公网流量，要知道按量的模式可是得收费的。而我是笔记本电脑上的一台虚拟机，最终访问出去用的是所在电信的一个公网ip，当然访问不到阿里内网。</p>
<h4 id="配置社区版容器源"><a href="#配置社区版容器源" class="headerlink" title="配置社区版容器源"></a>配置社区版容器源</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@localhost yum.repos.d]<span class="comment"># yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span></div><div class="line">已加载插件：fastestmirror, langpacks</div><div class="line">adding repo from: http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</div><div class="line">grabbing file http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo to /etc/yum.repos.d/docker-ce.repo</div><div class="line">repo saved to /etc/yum.repos.d/docker-ce.repo</div></pre></td></tr></table></figure>
<h3 id="老版本容器卸载（假设你之前没安装过容器，可跳过此步骤）"><a href="#老版本容器卸载（假设你之前没安装过容器，可跳过此步骤）" class="headerlink" title="老版本容器卸载（假设你之前没安装过容器，可跳过此步骤）"></a>老版本容器卸载（假设你之前没安装过容器，可跳过此步骤）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@localhost yum.repos.d]<span class="comment"># yum remove docker docker-common docker-selinux docker-engine</span></div><div class="line">已加载插件：fastestmirror, langpacks</div><div class="line">参数 docker 没有匹配</div><div class="line">参数 docker-common 没有匹配</div><div class="line">参数 docker-selinux 没有匹配</div><div class="line">参数 docker-engine 没有匹配</div><div class="line">不删除任何软件包</div></pre></td></tr></table></figure>
<h3 id="安装所依赖软件"><a href="#安装所依赖软件" class="headerlink" title="安装所依赖软件"></a>安装所依赖软件</h3><p>yum-utils提供 yum-config-manager管理能力,  device-mapper-persistent-data和lvm2是存储驱动。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">yum install -y yum-utils \</div><div class="line">  device-mapper-persistent-data \</div><div class="line">  lvm2</div></pre></td></tr></table></figure></p>
<h3 id="社区版容器安装"><a href="#社区版容器安装" class="headerlink" title="社区版容器安装"></a>社区版容器安装</h3><p>默认安装最近最新版本。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install docker-ce -y</div></pre></td></tr></table></figure></p>
<p>特定版本安装<br>列出有哪些版本<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[root@localhost yum.repos.d]<span class="comment"># yum list docker-ce --showduplicates | sort -r</span></div><div class="line">已加载插件：fastestmirror, langpacks</div><div class="line">可安装的软件包</div><div class="line"> * updates: mirrors.aliyun.com</div><div class="line">Loading mirror speeds from cached hostfile</div><div class="line"> * extras: mirrors.aliyun.com</div><div class="line"> * epel: mirrors.aliyun.com</div><div class="line">docker-ce.x86_64            17.06.2.ce-1.el7.centos             docker-ce-stable</div><div class="line">docker-ce.x86_64            17.06.1.ce-1.el7.centos             docker-ce-stable</div><div class="line">docker-ce.x86_64            17.06.0.ce-1.el7.centos             docker-ce-stable</div><div class="line">docker-ce.x86_64            17.03.2.ce-1.el7.centos             docker-ce-stable</div><div class="line">docker-ce.x86_64            17.03.1.ce-1.el7.centos             docker-ce-stable</div><div class="line">docker-ce.x86_64            17.03.0.ce-1.el7.centos             docker-ce-stable</div></pre></td></tr></table></figure></p>
<p>下面以安装17.06.1版本为例<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@localhost yum.repos.d]<span class="comment"># yum install docker-ce-17.06.1.ce</span></div></pre></td></tr></table></figure></p>
<h3 id="运行第一个容器"><a href="#运行第一个容器" class="headerlink" title="运行第一个容器"></a>运行第一个容器</h3><h4 id="尝试运行第一个容器"><a href="#尝试运行第一个容器" class="headerlink" title="尝试运行第一个容器"></a>尝试运行第一个容器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">[root@localhost yum.repos.d]<span class="comment"># systemctl  start docker</span></div><div class="line">[root@localhost yum.repos.d]<span class="comment"># systemctl  status docker</span></div><div class="line">● docker.service - Docker Application Container Engine</div><div class="line">   Loaded: loaded (/usr/lib/systemd/system/docker.service; disabled; vendor preset: disabled)</div><div class="line">   Active: active (running) since 日 2017-10-22 14:14:07 CST; 8s ago</div><div class="line">     Docs: https://docs.docker.com</div><div class="line"> Main PID: 7963 (dockerd)</div><div class="line">   Memory: 16.2M</div><div class="line">   CGroup: /system.slice/docker.service</div><div class="line">           ├─7963 /usr/bin/dockerd</div><div class="line">           └─7969 docker-containerd -l unix:///var/run/docker/libcontainerd/docker-containerd.sock --metrics-inte...</div><div class="line">10月 22 14:14:07 localhost.localdomain dockerd[7963]: time=<span class="string">"2017-10-22T14:14:07.858203582+08:00"</span> level=info ...ock<span class="string">"</span></div><div class="line"><span class="string">10月 22 14:14:07 localhost.localdomain systemd[1]: Started Docker Application Container Engine.</span></div><div class="line"><span class="string">Hint: Some lines were ellipsized, use -l to show in full.</span></div><div class="line"><span class="string">[root@localhost yum.repos.d]# docker run hello-world</span></div><div class="line"><span class="string">Unable to find image 'hello-world:latest' locally</span></div><div class="line"><span class="string">docker: Error response from daemon: Get https://registry-1.docker.io/v2/library/hello-world/manifests/latest: Get https://auth.docker.io/token?scope=repository%3Alibrary%2Fhello-world%3Apull&amp;service=registry.docker.io: net/http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers).</span></div><div class="line"><span class="string">See 'docker run --help'.</span></div></pre></td></tr></table></figure>
<h4 id="配置容器国内源"><a href="#配置容器国内源" class="headerlink" title="配置容器国内源"></a>配置容器国内源</h4><p>运行第一个容器hello-world，本地没有容器镜像，默认从国外docker公司拉取镜像，拉取超时失败。<br>所以我们配置国内源，下面以<a href="https://www.daocloud.io/" target="_blank" rel="external">DaoCloud</a>为例，得先注册账号。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@localhost yum.repos.d]<span class="comment"># curl -sSL https://get.daocloud.io/daotools/set_mirror.sh | sh -s http://8b3fddac.m.daocloud.io</span></div><div class="line">docker version &gt;= 1.12</div><div class="line">&#123;<span class="string">"registry-mirrors"</span>: [<span class="string">"http://8b3fddac.m.daocloud.io"</span>]&#125;</div><div class="line">Success.</div><div class="line">You need to restart docker to take effect: sudo systemctl restart docker </div><div class="line">[root@localhost yum.repos.d]<span class="comment"># systemctl restart docker</span></div></pre></td></tr></table></figure></p>
<p>其实就是配置了下面这个json 配置文件，重启docker 服务后生效。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@localhost yum.repos.d]<span class="comment"># cat /etc/docker/daemon.json </span></div><div class="line">&#123;<span class="string">"registry-mirrors"</span>: [<span class="string">"http://8b3fddac.m.daocloud.io"</span>]&#125;</div></pre></td></tr></table></figure></p>
<h4 id="重新运行第一个容器"><a href="#重新运行第一个容器" class="headerlink" title="重新运行第一个容器"></a>重新运行第一个容器</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">[root@localhost yum.repos.d]<span class="comment"># docker run hello-world</span></div><div class="line">Unable to find image <span class="string">'hello-world:latest'</span> locally</div><div class="line">latest: Pulling from library/hello-world</div><div class="line">5b0f327be733: Pull complete </div><div class="line">Digest: sha256:a69dda95faa021234ab2d92118e9539d0175b46587803e32435ea2e534f2db06</div><div class="line">Status: Downloaded newer image <span class="keyword">for</span> hello-world:latest</div><div class="line"></div><div class="line">Hello from Docker!</div><div class="line">This message shows that your installation appears to be working correctly.</div><div class="line"></div><div class="line">To generate this message, Docker took the following steps:</div><div class="line"> 1. The Docker client contacted the Docker daemon.</div><div class="line"> 2. The Docker daemon pulled the <span class="string">"hello-world"</span> image from the Docker Hub.</div><div class="line"> 3. The Docker daemon created a new container from that image <span class="built_in">which</span> runs the</div><div class="line">    executable that produces the output you are currently reading.</div><div class="line"> 4. The Docker daemon streamed that output to the Docker client, <span class="built_in">which</span> sent it</div><div class="line">    to your terminal.</div><div class="line"></div><div class="line">To try something more ambitious, you can run an Ubuntu container with:</div><div class="line"> $ docker run -it ubuntu bash</div><div class="line"></div><div class="line">Share images, automate workflows, and more with a free Docker ID:</div><div class="line"> https://cloud.docker.com/</div><div class="line"></div><div class="line">For more examples and ideas, visit:</div><div class="line"> https://docs.docker.com/engine/userguide/</div></pre></td></tr></table></figure>
<p>至此第一个容器就运行起来了，如果你的操作系统是其他版本，可以参考<a href="https://docs.docker.com/engine/installation/" target="_blank" rel="external">容器官网文档</a>。</p>
]]></content>
      
        <categories>
            
            <category> 技术 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> docker </tag>
            
            <tag> 容器 </tag>
            
            <tag> centos7 </tag>
            
            <tag> 云平台技术 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[搭建免费博客（下）]]></title>
      <url>/2017/10/22/bulid-blog-log-2/</url>
      <content type="html"><![CDATA[<h2 id="写在前面的话"><a href="#写在前面的话" class="headerlink" title="写在前面的话"></a>写在前面的话</h2><p>很久之前一直想写博客，总是觉得博客页面的广告太多，页面风格不合自己心意，所以迟迟没有落实。偶然的机会看到hexo+github 搭建的静态博客，完全可以按照自己的想法定义，真的很开心。个人觉得静态博客虽然有许许多多的优点，但是也还是存在小缺点：更新相当于没有。像基础架构的底层架构的设计，起初的时候就要考虑特别完善，不然后面整改起来真的是要命，不可能三天两头的去变更它。所以博客的功能布局等，我在搭好的两天就尽可能的改成自己最终想要的样子，后面就是不断更新文章了。</p>
<ul>
<li>_config.yml：全局配置文件，大多数的设置都在这里</li>
<li>node_modules: hexo安装插件模块的目录</li>
<li>package.json：应用程序数据，指明hexo的版本信息和依赖的模块及其版本</li>
<li>public：执行hexo generate命令，输出的静态网页内容目录。真正deploy到github的文件目录</li>
<li>scaffolds：layout模板文件目录，其中的md文件可以添加编辑</li>
<li>source：文章源码目录，目录下的markdown和html文件均会被hexo处理</li>
<li>themes：主题安装目录</li>
</ul>
<h2 id="版权信息的增加"><a href="#版权信息的增加" class="headerlink" title="版权信息的增加"></a>版权信息的增加</h2><h3 id="修改全局配置文件"><a href="#修改全局配置文件" class="headerlink" title="修改全局配置文件"></a>修改全局配置文件</h3><p>shanguanyunya.github.io/_config.yml<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">url: https://shanguanyunya.github.io</div></pre></td></tr></table></figure></p>
<h3 id="修改主题配置文件"><a href="#修改主题配置文件" class="headerlink" title="修改主题配置文件"></a>修改主题配置文件</h3><p>shanguanyunya.github.io/themes/next/_config.yml<br>enable value 改为true<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">post_copyright:</div><div class="line"> enable: true</div><div class="line"> license: CC BY-NC-SA 3.0</div></pre></td></tr></table></figure></p>
<h2 id="访客信息统计"><a href="#访客信息统计" class="headerlink" title="访客信息统计"></a>访客信息统计</h2><h3 id="修改主题配置文件-1"><a href="#修改主题配置文件-1" class="headerlink" title="修改主题配置文件"></a>修改主题配置文件</h3><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">busuanzi_count:</div><div class="line">  <span class="comment"># count values only if the other configs are false</span></div><div class="line">  enable: true</div><div class="line">  <span class="comment"># custom uv span for the whole site</span></div><div class="line">  site_uv: true</div><div class="line">  site_uv_header: &lt;i class="fa fa-user"&gt;&lt;/i&gt; 本站总访客数</div><div class="line">  site_uv_footer: 人</div><div class="line">  <span class="comment"># custom pv span for the whole site</span></div><div class="line">  site_pv: true</div><div class="line">  site_pv_header: &lt;i class="fa fa-eye"&gt;&lt;/i&gt; 本站总访问量</div><div class="line">  site_pv_footer: 人次</div><div class="line">  <span class="comment"># custom pv span for one page only</span></div><div class="line">  page_pv: false</div><div class="line">  page_pv_header: &lt;i class="fa fa-file-o"&gt;&lt;/i&gt;</div><div class="line">  page_pv_footer</div></pre></td></tr></table></figure>
<h2 id="本地搜索"><a href="#本地搜索" class="headerlink" title="本地搜索"></a>本地搜索</h2><h3 id="插件安装"><a href="#插件安装" class="headerlink" title="插件安装"></a>插件安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install --save hexo-generator-search</div></pre></td></tr></table></figure>
<h3 id="修改主题配置文件-2"><a href="#修改主题配置文件-2" class="headerlink" title="修改主题配置文件"></a>修改主题配置文件</h3><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">local_search:</div><div class="line">  enable: true</div></pre></td></tr></table></figure>
<h2 id="字数统计和预计阅读时长"><a href="#字数统计和预计阅读时长" class="headerlink" title="字数统计和预计阅读时长"></a>字数统计和预计阅读时长</h2><h3 id="插件安装-1"><a href="#插件安装-1" class="headerlink" title="插件安装"></a>插件安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install hexo-wordcount@2 --save</div></pre></td></tr></table></figure>
<h3 id="修改主题配置文件-3"><a href="#修改主题配置文件-3" class="headerlink" title="修改主题配置文件"></a>修改主题配置文件</h3><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">post_wordcount:</div><div class="line">  item_text: true</div><div class="line">  wordcount: true</div><div class="line">  min2read: true</div><div class="line">  totalcount: true</div><div class="line">  separated_meta: true</div></pre></td></tr></table></figure>
<h3 id="增加单位（字、分钟）"><a href="#增加单位（字、分钟）" class="headerlink" title="增加单位（字、分钟）"></a>增加单位（字、分钟）</h3><p>修改文件themes\next\layout_macro\post.swig<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"> &lt;span title="&#123;&#123; __('post.wordcount') &#125;&#125;"&gt;</div><div class="line">    &#123;&#123; wordcount(post.content) &#125;&#125; 字</div><div class="line">   &lt;/span&gt;</div><div class="line"></div><div class="line">&lt;span title="&#123;&#123; __('post.min2read') &#125;&#125;"&gt;</div><div class="line">  &#123;&#123; min2read(post.content) &#125;&#125; 分钟</div><div class="line">&lt;/span&gt;</div></pre></td></tr></table></figure></p>
<h3 id="页底字数总统计由英文改成中文"><a href="#页底字数总统计由英文改成中文" class="headerlink" title="页底字数总统计由英文改成中文"></a>页底字数总统计由英文改成中文</h3><p>修改文件themes\next\languages/zh-Hans.yml<br>注意我的主配置文件就是语言就是使用的zh-Hans<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">totalcount: 本站总字数统计</div></pre></td></tr></table></figure></p>
<h2 id="主页每篇博文显示阅读全文，而不是每篇都显示所有内容"><a href="#主页每篇博文显示阅读全文，而不是每篇都显示所有内容" class="headerlink" title="主页每篇博文显示阅读全文，而不是每篇都显示所有内容"></a>主页每篇博文显示阅读全文，而不是每篇都显示所有内容</h2><h3 id="修改主题配置文件-4"><a href="#修改主题配置文件-4" class="headerlink" title="修改主题配置文件"></a>修改主题配置文件</h3><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">auto_excerpt:</div><div class="line">enable: true</div><div class="line">length: 150</div></pre></td></tr></table></figure>
<h2 id="社交信息"><a href="#社交信息" class="headerlink" title="社交信息"></a>社交信息</h2><h3 id="修改主题配置文件-5"><a href="#修改主题配置文件-5" class="headerlink" title="修改主题配置文件"></a>修改主题配置文件</h3><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">social:</div><div class="line">GitHub: https://github.com/shanguanyunya || github</div><div class="line">E-Mail: mailto:zhaoqianzhang@yeah.net || envelope</div><div class="line"></div><div class="line">social_icons:</div><div class="line">enable: true</div></pre></td></tr></table></figure>
<h3 id="配套修改主题信息和侧边栏在右边一直显示"><a href="#配套修改主题信息和侧边栏在右边一直显示" class="headerlink" title="配套修改主题信息和侧边栏在右边一直显示"></a>配套修改主题信息和侧边栏在右边一直显示</h3><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">  sidebar:</div><div class="line">  </div><div class="line">  position: right</div><div class="line">    display: always</div><div class="line">	</div><div class="line"><span class="comment"># Scheme Settings</span></div><div class="line">scheme: Pisces</div></pre></td></tr></table></figure>
<h2 id="友情链接"><a href="#友情链接" class="headerlink" title="友情链接"></a>友情链接</h2><h3 id="修改主题配置文件-6"><a href="#修改主题配置文件-6" class="headerlink" title="修改主题配置文件"></a>修改主题配置文件</h3><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"> <span class="comment"># Blog rolls</span></div><div class="line">links_title: 友情链接</div><div class="line"><span class="comment">#links_layout: block</span></div><div class="line"><span class="comment">#links_layout: inline</span></div><div class="line">links:</div><div class="line">   我的新浪博客: http://blog.sina.com.cn/shangguanyunya/</div></pre></td></tr></table></figure>
<h2 id="博文文末自动加结束语"><a href="#博文文末自动加结束语" class="headerlink" title="博文文末自动加结束语"></a>博文文末自动加结束语</h2><p> \themes\next\layout_macro 中新建 passage-end-tag.swig 文件</p>
<h3 id="passage-end-tag-swig-文件内容"><a href="#passage-end-tag-swig-文件内容" class="headerlink" title="passage-end-tag.swig 文件内容"></a>passage-end-tag.swig 文件内容</h3><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"> &lt;div&gt;</div><div class="line">    &#123;% if not is_index %&#125;</div><div class="line">        &lt;div style="text-align:center;color: #ccc;heart:32px;"&gt;----纸上得来终觉浅&lt;i class="fa fa-heart"&gt;&lt;/i&gt;绝知此事要躬行----&lt;/div&gt;</div><div class="line">    &#123;% endif %&#125;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure>
<h3 id="themes-next-layout-macro-post-swig-END-POST-BODY后增加"><a href="#themes-next-layout-macro-post-swig-END-POST-BODY后增加" class="headerlink" title="\themes\next\layout_macro\post.swig,END POST BODY后增加"></a>\themes\next\layout_macro\post.swig,END POST BODY后增加</h3><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">    &#123;#####################&#125;</div><div class="line">    &#123;### END POST BODY ###&#125;</div><div class="line">    &#123;#####################&#125;</div><div class="line">&lt;div&gt;</div><div class="line">  &#123;% if not is_index %&#125;</div><div class="line">    &#123;% include 'passage-end-tag.swig' %&#125;</div><div class="line">  &#123;% endif %&#125;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure>
<h3 id="主题配置文件末尾增加"><a href="#主题配置文件末尾增加" class="headerlink" title="主题配置文件末尾增加"></a>主题配置文件末尾增加</h3><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 文章末尾添加“本文结束”标记</span></div><div class="line">passage_end_tag:</div><div class="line">  enabled: true</div></pre></td></tr></table></figure>
<h2 id="标签和分类"><a href="#标签和分类" class="headerlink" title="标签和分类"></a>标签和分类</h2><h3 id="新建标签页面"><a href="#新建标签页面" class="headerlink" title="新建标签页面"></a>新建标签页面</h3><p>hexo new page “tags” 把对应的shanguanyunya.github.io/source/tags/index.md<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">---</div><div class="line">title: 标签</div><div class="line">date: 2017-10-18 22:11:43</div><div class="line">type: "tags"</div><div class="line">---</div></pre></td></tr></table></figure></p>
<h3 id="新建分类页面"><a href="#新建分类页面" class="headerlink" title="新建分类页面"></a>新建分类页面</h3><p>hexo new page “categories” 把对应的shanguanyunya.github.io/source/categories/index.md<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">---</div><div class="line">---</div><div class="line">title: 分类</div><div class="line">date: 2017-10-18 19:08:14</div><div class="line">type: "categories"</div><div class="line">---</div></pre></td></tr></table></figure></p>
<h3 id="要发布的博文加具体标签字段和分类字段"><a href="#要发布的博文加具体标签字段和分类字段" class="headerlink" title="要发布的博文加具体标签字段和分类字段"></a>要发布的博文加具体标签字段和分类字段</h3><p>建议一篇博客可以有多个标签，但是只属于一个分类</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">---</div><div class="line">title: Hello World</div><div class="line">tags: [测试]</div><div class="line">categories: </div><div class="line">- 博客</div><div class="line">---</div></pre></td></tr></table></figure>
<h2 id="页头进度条加载进度动画"><a href="#页头进度条加载进度动画" class="headerlink" title="页头进度条加载进度动画"></a>页头进度条加载进度动画</h2><h3 id="修改主题配置文件-7"><a href="#修改主题配置文件-7" class="headerlink" title="修改主题配置文件"></a>修改主题配置文件</h3><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Progress bar in the top during page loading.</span></div><div class="line">pace: true</div></pre></td></tr></table></figure>
<h2 id="标签-修改成图标"><a href="#标签-修改成图标" class="headerlink" title="标签# 修改成图标"></a>标签# 修改成图标</h2><p> 图标网址<a href="http://fontawesome.io/icons/" target="_blank" rel="external">http://fontawesome.io/icons/</a></p>
<h3 id="修改修改模板-themes-next-layout-macro-post-swig"><a href="#修改修改模板-themes-next-layout-macro-post-swig" class="headerlink" title="修改修改模板/themes/next/layout/_macro/post.swig"></a>修改修改模板/themes/next/layout/_macro/post.swig</h3><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">搜索 rel="tag"&gt;#，将 # 换成&lt;i class="fa fa-tag"&gt;&lt;/i&gt;</div></pre></td></tr></table></figure>
<h2 id="右侧向上小箭头显示阅读百分比"><a href="#右侧向上小箭头显示阅读百分比" class="headerlink" title="右侧向上小箭头显示阅读百分比"></a>右侧向上小箭头显示阅读百分比</h2><h3 id="修改主题配置文件-8"><a href="#修改主题配置文件-8" class="headerlink" title="修改主题配置文件"></a>修改主题配置文件</h3><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Scroll percent label in b2t button.</span></div><div class="line">scrollpercent: true</div></pre></td></tr></table></figure>
<h2 id="光标滑到作者头像转动"><a href="#光标滑到作者头像转动" class="headerlink" title="光标滑到作者头像转动"></a>光标滑到作者头像转动</h2><h3 id="themes-next-source-css-common-components-sidebar-sidebar-author-styl-后面增加下面代码"><a href="#themes-next-source-css-common-components-sidebar-sidebar-author-styl-后面增加下面代码" class="headerlink" title="themes\next\source\css_common\components\sidebar\sidebar-author.styl 后面增加下面代码"></a>themes\next\source\css_common\components\sidebar\sidebar-author.styl 后面增加下面代码</h3><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">.site-author-image &#123;</div><div class="line">  display: block;</div><div class="line">  margin: 0 auto;</div><div class="line">  padding: $site-author-image-padding;</div><div class="line">  max-width: $site-author-image-width;</div><div class="line">  height: $site-author-image-height;</div><div class="line">  border: $site-author-image-border-width solid $site-author-image-border-color;</div><div class="line">  /* 头像圆形 */</div><div class="line">  border-radius: 80px;</div><div class="line">  -webkit-border-radius: 80px;</div><div class="line">  -moz-border-radius: 80px;</div><div class="line">  box-shadow: inset 0 -1px 0 #333sf;</div><div class="line">  /* 设置循环动画 [animation: (play)动画名称 (2s)动画播放时长单位秒或微秒 (ase-out)动画播放的速度曲线为以低速结束 </div><div class="line">    (1s)等待1秒然后开始动画 (1)动画播放次数(infinite为循环播放) ]*/</div><div class="line"> </div><div class="line">  /* 鼠标经过头像旋转360度 */</div><div class="line">  -webkit-transition: -webkit-transform 1.0s ease-out;</div><div class="line">  -moz-transition: -moz-transform 1.0s ease-out;</div><div class="line">  transition: transform 1.0s ease-out;</div><div class="line">&#125;</div><div class="line">img:hover &#123;</div><div class="line">  /* 鼠标经过停止头像旋转 </div><div class="line">  -webkit-animation-play-state:paused;</div><div class="line">  animation-play-state:paused;*/</div><div class="line">  /* 鼠标经过头像旋转360度 */</div><div class="line">  -webkit-transform: rotateZ(360deg);</div><div class="line">  -moz-transform: rotateZ(360deg);</div><div class="line">  transform: rotateZ(360deg);</div><div class="line">&#125;</div><div class="line">/* Z 轴旋转动画 */</div><div class="line">@-webkit-keyframes play &#123;</div><div class="line">  0% &#123;</div><div class="line">    -webkit-transform: rotateZ(0deg);</div><div class="line">  &#125;</div><div class="line">  100% &#123;</div><div class="line">    -webkit-transform: rotateZ(-360deg);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">@-moz-keyframes play &#123;</div><div class="line">  0% &#123;</div><div class="line">    -moz-transform: rotateZ(0deg);</div><div class="line">  &#125;</div><div class="line">  100% &#123;</div><div class="line">    -moz-transform: rotateZ(-360deg);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">@keyframes play &#123;</div><div class="line">  0% &#123;</div><div class="line">    transform: rotateZ(0deg);</div><div class="line">  &#125;</div><div class="line">  100% &#123;</div><div class="line">    transform: rotateZ(-360deg);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="修改文章内链接文本样式"><a href="#修改文章内链接文本样式" class="headerlink" title="修改文章内链接文本样式"></a>修改文章内链接文本样式</h2><h3 id="修改文件-themes-next-source-css-common-components-post-post-styl"><a href="#修改文件-themes-next-source-css-common-components-post-post-styl" class="headerlink" title="修改文件 themes\next\source\css_common\components\post\post.styl"></a>修改文件 themes\next\source\css_common\components\post\post.styl</h3><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">// 文章内链接文本样式</div><div class="line">.post-body p a&#123;</div><div class="line">  color: #0593d3;</div><div class="line">  border-bottom: none;</div><div class="line">  border-bottom: 1px solid #0593d3;</div><div class="line">  &amp;:hover &#123;</div><div class="line">    color: #fc6423;</div><div class="line">    border-bottom: none;</div><div class="line">    border-bottom: 1px solid #fc6423;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="博文中图片发布"><a href="#博文中图片发布" class="headerlink" title="博文中图片发布"></a>博文中图片发布</h2><h3 id="注册七牛云账号、上传图片、获取永久外链"><a href="#注册七牛云账号、上传图片、获取永久外链" class="headerlink" title="注册七牛云账号、上传图片、获取永久外链"></a>注册七牛云账号、上传图片、获取永久外链</h3><p>每月1G 免费空间及流量<br><a href="https://www.qiniu.com" target="_blank" rel="external">https://www.qiniu.com</a></p>
<p>###博文图片设置<br>其中80p表示图片缩放至原来80%大小<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">##文章图片测试</span></div><div class="line">云南崇圣寺</div><div class="line">![](http://oy2fglccv.bkt.clouddn.com/chunshengshi_ta.jpg?imageMogr2/thumbnail/!80p)</div></pre></td></tr></table></figure></p>
<h2 id="文章输入正确密码才能访问"><a href="#文章输入正确密码才能访问" class="headerlink" title="文章输入正确密码才能访问"></a>文章输入正确密码才能访问</h2><h3 id="修改themes-gt-next-gt-layout-gt-partials-gt-head-swig文件"><a href="#修改themes-gt-next-gt-layout-gt-partials-gt-head-swig文件" class="headerlink" title="修改themes-&gt;next-&gt;layout-&gt;_partials-&gt;head.swig文件"></a>修改themes-&gt;next-&gt;layout-&gt;_partials-&gt;head.swig文件</h3><p>增加//add后面代码<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">      &#123;% set pace_css_uri = theme.vendors.pace_css %&#125;</div><div class="line">    &#123;% endif %&#125;</div><div class="line">//add		</div><div class="line">  &lt;script src="&#123;&#123; pace_js_uri &#125;&#125;"&gt;&lt;/script&gt;</div><div class="line">  &lt;link href="&#123;&#123; pace_css_uri &#125;&#125;" rel="stylesheet"&gt;</div><div class="line">&lt;script&gt;</div><div class="line">    (function()&#123;</div><div class="line">        if('&#123;&#123; page.password &#125;&#125;')&#123;</div><div class="line">            if (prompt('请输入文章密码') !== '&#123;&#123; page.password &#125;&#125;')&#123;</div><div class="line">                alert('密码错误！');</div><div class="line">                history.back();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;)();</div><div class="line">&lt;/script&gt;</div></pre></td></tr></table></figure></p>
<h3 id="每篇博文文件中自定义访问密码index-md文件"><a href="#每篇博文文件中自定义访问密码index-md文件" class="headerlink" title="每篇博文文件中自定义访问密码index.md文件"></a>每篇博文文件中自定义访问密码index.md文件</h3><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">password: xxxxxxx</div></pre></td></tr></table></figure>
<h2 id="常用命令及解释"><a href="#常用命令及解释" class="headerlink" title="常用命令及解释"></a>常用命令及解释</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">hexo g == hexo generate  ==生成</div><div class="line">hexo d == hexo deploy    ==发布</div><div class="line">hexo s == hexo server    ==运行</div><div class="line">hexo n == hexo new       ==新建</div><div class="line"></div><div class="line">组合</div><div class="line">hexo s -p 8080   本地运行测试并指定端口</div><div class="line">hexo clean &amp;&amp; hexo g &amp;&amp; hexo d  清理后重新生成再发布</div></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> 技术 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 博客 </tag>
            
            <tag> 测试 </tag>
            
            <tag> 原创 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Chinese test]]></title>
      <url>/2017/10/20/test/</url>
      <content type="html"><![CDATA[<h2 id="中文测试"><a href="#中文测试" class="headerlink" title="中文测试"></a>中文测试</h2><h3 id="春江花月夜-张若虚"><a href="#春江花月夜-张若虚" class="headerlink" title="春江花月夜  张若虚"></a>春江花月夜  张若虚</h3><p>春江潮水连海平，海上明月共潮生。<br>滟滟随波千万里，何处春江无月明！<br>江流宛转绕芳甸，月照花林皆似霰；<br>空里流霜不觉飞，汀上白沙看不见。<br>江天一色无纤尘，皎皎空中孤月轮。<br>江畔何人初见月？江月何年初照人？<br>人生代代无穷已，江月年年只相似。<br>不知江月待何人，但见长江送流水。<br>白云一片去悠悠，青枫浦上不胜愁。<br>谁家今夜扁舟子？何处相思明月楼？<br>可怜楼上月徘徊，应照离人妆镜台。<br>玉户帘中卷不去，捣衣砧上拂还来。<br>此时相望不相闻，愿逐月华流照君。<br>鸿雁长飞光不度，鱼龙潜跃水成文。<br>昨夜闲潭梦落花，可怜春半不还家。<br>江水流春去欲尽，江潭落月复西斜。<br>斜月沉沉藏海雾，碣石潇湘无限路。<br>不知乘月几人归，落月摇情满江树。</p>
<h2 id="bash-test-time-update"><a href="#bash-test-time-update" class="headerlink" title="bash test (time update)"></a>bash test (time update)</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"></div><div class="line">TlinuxIssue=`cat /etc/issue |grep -i tlinux |grep 1.2 |wc -l`</div><div class="line">KERNEL=`uname -a |awk <span class="string">'&#123;print $3&#125;'</span>|awk -F <span class="string">'.'</span> <span class="string">'&#123;print $1&#125;'</span>`</div><div class="line">Ntpserver=`cat /etc/ntp.conf |grep -i ^server|head -n1|awk <span class="string">'&#123;print $2&#125;'</span>`</div><div class="line"></div><div class="line"><span class="comment">#suit for  user mode centos 6</span></div><div class="line"><span class="keyword">function</span>  ntpupdate6()</div><div class="line">&#123;</div><div class="line">/etc/init.d/ntpd stop</div><div class="line">ntpdate  <span class="variable">$Ntpserver</span></div><div class="line">chkconfig --level 35 ntpd on</div><div class="line">/etc/init.d/ntpd start</div><div class="line">hwclock -w --utc</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">#suit for  user mode centos 7</span></div><div class="line"><span class="keyword">function</span>  ntpupdate7()</div><div class="line">&#123;</div><div class="line">systemctl stop ntpd</div><div class="line">ntpdate  <span class="variable">$Ntpserver</span></div><div class="line">systemctl <span class="built_in">enable</span> ntpd</div><div class="line">systemctl start ntpd</div><div class="line">hwclock -w --utc</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">case</span> <span class="variable">$KERNEL</span> <span class="keyword">in</span></div><div class="line">  2)</div><div class="line">ntpupdate6</div><div class="line">   ;;   </div><div class="line">  3)</div><div class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$TlinuxIssue</span>"</span> -gt <span class="string">"0"</span> ]</div><div class="line"><span class="keyword">then</span> </div><div class="line">    ntpupdate6</div><div class="line"><span class="keyword">else</span> </div><div class="line">    ntpupdate7</div><div class="line"><span class="keyword">fi</span></div><div class="line">   ;;</div><div class="line">  *)</div><div class="line"><span class="built_in">exit</span> </div><div class="line">   ;;</div><div class="line"><span class="keyword">esac</span></div></pre></td></tr></table></figure>
<h2 id="图片测试"><a href="#图片测试" class="headerlink" title="图片测试"></a>图片测试</h2><p><img src="http://oy2fglccv.bkt.clouddn.com/chunjianghuayueye.jpg?imageMogr2/thumbnail/!80p" alt=""></p>
]]></content>
      
        <categories>
            
            <category> 博客 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 测试 </tag>
            
            <tag> shell </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[mindoc 文档管理系统搭建]]></title>
      <url>/2017/10/20/mindoc-build/</url>
      <content type="html"><![CDATA[<h1 id="写在前面的话"><a href="#写在前面的话" class="headerlink" title="写在前面的话"></a>写在前面的话</h1><h2 id="每篇一句"><a href="#每篇一句" class="headerlink" title="每篇一句"></a>每篇一句</h2><p><strong>行百里者半九十</strong></p>
<p>   你是否有N个内网系统，各种环境：生产、灾备、测试，系统越来越多，你只能靠你的小本本记录，同事也是常互相询问所管理的系统访问地址。作为运维的你,开发的一些自动化脚本，你想同事在你休假的时候明白其调用方法。你总结的文章想共享在内部系统。那么你可以尝试下mindoc这个工具。</p>
<h1 id="MinDoc-简介"><a href="#MinDoc-简介" class="headerlink" title="MinDoc 简介"></a>MinDoc 简介</h1><p>下面这段介绍来源于搭建好mindoc 创建的普通文档模版</p>
<blockquote>
<p>MinDoc 是一款针对IT团队开发的简单好用的文档管理系统。</p>
<p>MinDoc 的前身是 SmartWiki 文档系统。SmartWiki 是基于 PHP 框架 laravel 开发的一款文档管理系统。因 PHP 的部署对普通用户来说太复杂，所以改用 Golang 开发。可以方便用户部署和实用。</p>
<p>开发缘起是公司IT部门需要一款简单实用的项目接口文档管理和分享的系统。其功能和界面源于 kancloud 。</p>
<p>可以用来储存日常接口文档，数据库字典，手册说明等文档。内置项目管理，用户管理，权限管理等功能，能够满足大部分中小团队的文档管理需求。</p>
<p>演示站点： <a href="http://doc.iminho.me" target="_blank" rel="external">http://doc.iminho.me</a></p>
</blockquote>
<h1 id="安装与使用"><a href="#安装与使用" class="headerlink" title="安装与使用"></a>安装与使用</h1><h2 id="安装环境介绍及版本"><a href="#安装环境介绍及版本" class="headerlink" title="安装环境介绍及版本"></a>安装环境介绍及版本</h2><p>glibc库要求大于等于2.14版本，Centos7默认自带满足，Centos6需要手动升级，有风险。</p>
<ul>
<li><p>Centos 7</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[root@master data]# uname -a </div><div class="line">Linux master 3.10.0-514.el7.x86_64 #1 SMP Tue Nov 22 16:42:41 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux</div><div class="line">[root@master data]# cat /etc/redhat-release </div><div class="line">CentOS Linux release 7.3.1611 (Core) </div><div class="line">[root@master mindoc]# rpm -qa |grep glibc</div><div class="line">glibc-headers-2.17-157.el7.x86_64</div><div class="line">compat-glibc-headers-2.12-4.el7.centos.x86_64</div><div class="line">glibc-2.17-157.el7.x86_64</div><div class="line">glibc-common-2.17-157.el7.x86_64</div><div class="line">glibc-devel-2.17-157.el7.x86_64</div><div class="line">compat-glibc-2.12-4.el7.centos.x86_64</div></pre></td></tr></table></figure>
</li>
<li><p>mysql 社区版5.7</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@master ~]# mysql -V</div><div class="line">mysql  Ver 14.14 Distrib 5.7.19, for Linux (x86_64) using  EditLine wrapper</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="安装前准备"><a href="#安装前准备" class="headerlink" title="安装前准备"></a>安装前准备</h2><h3 id="Centos-国内yum-源配置"><a href="#Centos-国内yum-源配置" class="headerlink" title="Centos 国内yum 源配置"></a>Centos 国内yum 源配置</h3><p>加快软件安装速度，国内有网易<a href="http://mirrors.163.com/" target="_blank" rel="external">163</a>、<a href="http://mirrors.aliyun.com/" target="_blank" rel="external">阿里</a>、<a href="https://mirrors.tuna.tsinghua.edu.cn/" target="_blank" rel="external">清华</a>等大学免费镜像站，下面以163为例。<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">cd /etc/yum.repos.d/</div><div class="line">mv CentOS-Base.repo CentOS-Base.repo.backup</div><div class="line">wget http://mirrors.163.com/.help/CentOS7-Base-163.repo</div><div class="line">yum clean all</div><div class="line">yum makecache</div></pre></td></tr></table></figure></p>
<h3 id="go-安装"><a href="#go-安装" class="headerlink" title="go 安装"></a>go 安装</h3><p>mindoc 是由go 语音编写的<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">cd /data/</div><div class="line">wget https://storage.googleapis.com/golang/go1.9.1.linux-amd64.tar.gz</div><div class="line">tar -C /usr/local -xzf go1.9.1.linux-amd64.tar.gz</div></pre></td></tr></table></figure></p>
<p>/etc/profile 文件增加go环境变量配置<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">export PATH=$PATH:/usr/local/go/bin</div></pre></td></tr></table></figure></p>
<p>使环境变量配置立即生效<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">source  /etc/profile</div></pre></td></tr></table></figure></p>
<p>验证go环境变量<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@master ~]# go version</div><div class="line">go version go1.9.1 linux/amd64</div></pre></td></tr></table></figure></p>
<h3 id="mysql-安装"><a href="#mysql-安装" class="headerlink" title="mysql 安装"></a>mysql 安装</h3><p><a href="(https://dev.mysql.com/downloads/" title="mysql下载网址">mysql下载网址</a><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">wget --no-check-certificate  https://repo.mysql.com/mysql57-community-release-el7-11.noarch.rpm</div><div class="line">rpm -ivh mysql57-community-release-el7-11.noarch.rpm</div><div class="line">yum install mysql-community-server</div></pre></td></tr></table></figure></p>
<h3 id="mysql-配置"><a href="#mysql-配置" class="headerlink" title="mysql 配置"></a>mysql 配置</h3><p>增加默认字符集配置，防止出现乱码<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="section">[root@master ~]</span><span class="comment"># cat /etc/my.cnf</span></div><div class="line"><span class="section">[mysqld]</span></div><div class="line"><span class="attr">datadir</span>=/var/lib/mysql</div><div class="line"><span class="attr">socket</span>=/var/lib/mysql/mysql.sock</div><div class="line"><span class="attr">symbolic-links</span>=<span class="number">0</span></div><div class="line"><span class="attr">log-error</span>=/var/log/mysqld.log</div><div class="line"><span class="attr">pid-file</span>=/var/run/mysqld/mysqld.pid</div><div class="line"><span class="attr">character_set_server</span>= utf8</div><div class="line"><span class="section">[client]</span></div><div class="line"><span class="attr">default-character-set</span>= utf8</div></pre></td></tr></table></figure></p>
<p>mysql 服务开启及确认开机自动启动<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">systemctl  start mysqld</div><div class="line">systemctl  enable mysqld</div><div class="line">[root@master ~]# systemctl list-unit-files |grep -i mysqld</div><div class="line">mysqld.service                             enabled</div></pre></td></tr></table></figure></p>
<p>mysql 初始密码<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="section">[root@master ~]</span><span class="comment"># cat /var/log/mysqld.log </span></div><div class="line">2017-10-16T06:59:09.365112Z 0 [Warning] TIMESTAMP with implicit DEFAULT value is deprecated. Please use --explicit_defaults_for_timestamp server option (see documentation for more details).</div><div class="line">2017-10-16T06:59:10.596156Z 0 [Warning] InnoDB: New log files created, LSN=45790</div><div class="line">2017-10-16T06:59:10.718918Z 0 [Warning] InnoDB: Creating foreign key constraint system tables.</div><div class="line">2017-10-16T06:59:10.778181Z 0 [Warning] No existing UUID has been found, so we assume that this is the first time that this server has been started. Generating a new UUID: 82f3affd-b23f-11e7-8a42-000c29530ed1.</div><div class="line">2017-10-16T06:59:10.779299Z 0 [Warning] Gtid table is not ready to be used. Table 'mysql.gtid_executed' cannot be opened.</div><div class="line">2017-10-16T06:59:10.780256Z 1 [Note] A temporary password is generated for root@localhost: G#(;vXBdp4il</div><div class="line">2017-10-16T06:59:14.047069Z 0 [Warning] TIMESTAMP with implicit DEFAULT value is deprecated. Please use --explicit_defaults_for_timestamp server option (see documentation for more details).</div></pre></td></tr></table></figure></p>
<p>用初始化密码(G#(;vXBdp4il)登录数据库,修改默认密码复杂要求策略及建用户<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line">[root@master yum.repos.d]# mysql -uroot -p</div><div class="line">Enter password: </div><div class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</div><div class="line">Your MySQL connection id is 6</div><div class="line">Server version: 5.7.19</div><div class="line"></div><div class="line"><span class="meta">mysql&gt;</span><span class="bash"> CREATE USER <span class="string">'mindoc'</span>@<span class="string">'localhost'</span> IDENTIFIED BY <span class="string">'123456'</span>;</span></div><div class="line">ERROR 1819 (HY000): Your password does not satisfy the current policy requirements</div><div class="line"><span class="meta">mysql&gt;</span><span class="bash"> SHOW VARIABLES LIKE <span class="string">'validate_password%'</span>;</span></div><div class="line">+--------------------------------------+--------+</div><div class="line">| Variable_name                        | Value  |</div><div class="line">+--------------------------------------+--------+</div><div class="line">| validate_password_check_user_name    | OFF    |</div><div class="line">| validate_password_dictionary_file    |        |</div><div class="line">| validate_password_length             | 8      |</div><div class="line">| validate_password_mixed_case_count   | 1      |</div><div class="line">| validate_password_number_count       | 1      |</div><div class="line">| validate_password_policy             | MEDIUM |</div><div class="line">| validate_password_special_char_count | 1      |</div><div class="line">+--------------------------------------+--------+</div><div class="line">7 rows in set (0.03 sec)</div><div class="line"></div><div class="line"><span class="meta">mysql&gt;</span><span class="bash"> <span class="built_in">set</span> global validate_password_policy=0;  </span></div><div class="line">Query OK, 0 rows affected (0.06 sec)</div><div class="line"></div><div class="line"><span class="meta">mysql&gt;</span><span class="bash"> <span class="built_in">set</span> global validate_password_mixed_case_count=0;  </span></div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line"><span class="meta">mysql&gt;</span><span class="bash"> <span class="built_in">set</span> global validate_password_number_count=3; </span></div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line"><span class="meta">mysql&gt;</span><span class="bash"> <span class="built_in">set</span> global validate_password_special_char_count=0; </span></div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line"><span class="meta">mysql&gt;</span><span class="bash"> <span class="built_in">set</span> global validate_password_length=3;</span></div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line"><span class="meta">mysql&gt;</span><span class="bash"> CREATE USER <span class="string">'mindoc'</span>@<span class="string">'localhost'</span> IDENTIFIED BY <span class="string">'123456'</span>;</span></div><div class="line">Query OK, 0 rows affected (0.09 sec)</div><div class="line"></div><div class="line"><span class="meta">mysql&gt;</span><span class="bash"> SHOW VARIABLES LIKE <span class="string">'validate_password%'</span>;</span></div><div class="line">+--------------------------------------+-------+</div><div class="line">| Variable_name                        | Value |</div><div class="line">+--------------------------------------+-------+</div><div class="line">| validate_password_check_user_name    | OFF   |</div><div class="line">| validate_password_dictionary_file    |       |</div><div class="line">| validate_password_length             | 3     |</div><div class="line">| validate_password_mixed_case_count   | 0     |</div><div class="line">| validate_password_number_count       | 3     |</div><div class="line">| validate_password_policy             | LOW   |</div><div class="line">| validate_password_special_char_count | 0     |</div><div class="line">+--------------------------------------+-------+</div><div class="line">7 rows in set (0.01 sec)</div><div class="line"></div><div class="line">set password for 'root'@'localhost' =password('password');</div><div class="line"></div><div class="line">CREATE USER 'mindoc'@'localhost' IDENTIFIED BY '123456';</div></pre></td></tr></table></figure></p>
<p>创建mindoc需要使用的数据库，并赋权限给mindoc用户本地可以访问及控制该库mindoc_db<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">mysql&gt; create database mindoc_db;</div><div class="line">Query OK, 1 row affected (0.01 sec)</div><div class="line"></div><div class="line">mysql&gt; grant all privileges on mindoc_db.* to mindoc@localhost ;</div><div class="line">Query OK, 0 rows affected (0.03 sec)</div></pre></td></tr></table></figure></p>
<p>字符集确认<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">mysql&gt; show variables like '%character%';</div><div class="line">+--------------------------+----------------------------+</div><div class="line">| Variable_name            | Value                      |</div><div class="line">+--------------------------+----------------------------+</div><div class="line">| character_set_client     | utf8                       |</div><div class="line">| character_set_connection | utf8                       |</div><div class="line">| character_set_database   | utf8                       |</div><div class="line">| character_set_filesystem | binary                     |</div><div class="line">| character_set_results    | utf8                       |</div><div class="line">| character_set_server     | utf8                       |</div><div class="line">| character_set_system     | utf8                       |</div><div class="line">| character_sets_dir       | /usr/share/mysql/charsets/ |</div><div class="line">+--------------------------+----------------------------+</div></pre></td></tr></table></figure></p>
<h2 id="mindoc-安装"><a href="#mindoc-安装" class="headerlink" title="mindoc 安装"></a>mindoc 安装</h2><p><a href="https://github.com/lifei6671/mindoc/releases" title="mindoc v0.6版本介质下载" target="_blank" rel="external">mindoc v0.6版本介质下载</a><br>介质下载后上传及解压<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">mkdir /data/mindoc</div><div class="line"><span class="built_in">cd</span> /data/mindoc</div><div class="line">tar -xzvf mindoc_linux_amd64.tar.gz </div><div class="line">[root@master mindoc]<span class="comment"># ls -l</span></div><div class="line">总用量 27436</div><div class="line">drwxr--r--  2 root root        6 10月 20 11:24 cache</div><div class="line">drwxrwxrwx  2 root root       46 10月 16 15:44 conf</div><div class="line">-rwxrwxrwx  1 root root     2462 7月  10 19:29 favicon.ico</div><div class="line">drwxrwxrwx  3 root root       18 7月  10 19:29 lib</div><div class="line">drwxr-xr-x  5 root root       33 10月 20 11:24 logs</div><div class="line">-rwxrwxrwx  1 root root 16718312 7月  10 19:32 mindoc_linux_amd64</div><div class="line">-rw-r--r--  1 root root 11327240 10月 16 15:23 mindoc_linux_amd64.tar.gz</div><div class="line">-rw-r--r--  1 root root    38020 10月 20 11:24 nohup.out</div><div class="line">drwxrwxrwx 23 root root      333 7月  10 19:29 static</div><div class="line">drwxrwxrwx  2 root root      258 7月  10 19:36 uploads</div><div class="line">drwxrwxrwx 13 root root      182 7月  10 19:29 views</div></pre></td></tr></table></figure></p>
<p>修改配置文件数据库配置部分，其他根据自身情况进行修改。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[root@master mindoc]<span class="comment"># cp conf/app.conf.example conf/app.conf</span></div><div class="line">[root@master mindoc]<span class="comment"># cat  conf/app.conf</span></div><div class="line"><span class="comment">####################MySQL 数据库配置###########################</span></div><div class="line"><span class="comment">#支持MySQL和sqlite3两种数据库，如果是sqlite3 则 db_database 标识数据库的物理目录</span></div><div class="line">db_adapter=mysql</div><div class="line">db_host=127.0.0.1</div><div class="line">db_port=3306</div><div class="line">db_database=mindoc_db</div><div class="line">db_username=mindoc</div><div class="line">db_password=123456</div></pre></td></tr></table></figure></p>
<p>执行数据库初始化脚本<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /data/mindoc</div><div class="line"> ./mindoc_linux_amd64 install</div></pre></td></tr></table></figure></p>
<h3 id="mindoc-启动运行及登录验证"><a href="#mindoc-启动运行及登录验证" class="headerlink" title="mindoc 启动运行及登录验证"></a>mindoc 启动运行及登录验证</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /data/mindoc</div><div class="line">nohup ./mindoc_linux_amd64 &gt;nohup.out 2&gt;&amp;1 &amp;</div></pre></td></tr></table></figure>
<p>注意linux防火墙需要打开8181端口，打开浏览器直接访问，默认用户名是admin，密码:123456<br>关闭防火墙<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@master mindoc]<span class="comment"># systemctl stop firewalld.service</span></div><div class="line">[root@master mindoc]<span class="comment"># systemctl status firewalld.service</span></div><div class="line">● firewalld.service - firewalld - dynamic firewall daemon</div><div class="line">   Loaded: loaded (/usr/lib/systemd/system/firewalld.service; disabled; vendor preset: enabled)</div><div class="line">   Active: inactive (dead)</div><div class="line">     Docs: man:firewalld(1)</div><div class="line">[root@master mindoc]<span class="comment"># systemctl disable firewalld.service</span></div></pre></td></tr></table></figure></p>
<h3 id="mindoc-做成服务开机自动启动"><a href="#mindoc-做成服务开机自动启动" class="headerlink" title="mindoc 做成服务开机自动启动"></a>mindoc 做成服务开机自动启动</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /data/mindoc</div><div class="line"> ./mindoc_linux_amd64 service install </div><div class="line">[root@master mindoc]<span class="comment"># systemctl start mindocd</span></div><div class="line">[root@master mindoc]<span class="comment"># systemctl enable mindocd</span></div><div class="line">[root@master mindoc]<span class="comment"># systemctl status  mindocd</span></div><div class="line">● mindocd.service - A document online management program.</div><div class="line">   Loaded: loaded (/etc/systemd/system/mindocd.service; enabled; vendor preset: disabled)</div><div class="line">   Active: active (running) since 五 2017-10-20 17:04:40 CST; 21s ago</div><div class="line"> Main PID: 18681 (mindoc_linux_am)</div><div class="line">   CGroup: /system.slice/mindocd.service</div><div class="line">           └─18681 /data/mindoc/mindoc_linux_amd64</div><div class="line"></div><div class="line">10月 20 17:04:40 master systemd[1]: Started A document online management program..</div><div class="line">10月 20 17:04:40 master systemd[1]: Starting A document online management program....</div><div class="line">10月 20 17:04:40 master mindoc_linux_amd64[18681]: MinDoc version =&gt; v0.6</div><div class="line">10月 20 17:04:40 master mindoc_linux_amd64[18681]: build time =&gt; Mon Jul 10 19:29:03 CST 2017</div><div class="line">10月 20 17:04:40 master mindoc_linux_amd64[18681]: start directory =&gt; /data/mindoc/mindoc_linux_amd64</div><div class="line">10月 20 17:04:40 master mindoc_linux_amd64[18681]: 2017/10/20 17:04:40 [I] [asm_amd64.s:2197] http server Running on http://:8181</div></pre></td></tr></table></figure>
<h2 id="mindoc-pdf-导出功能配置"><a href="#mindoc-pdf-导出功能配置" class="headerlink" title="mindoc pdf 导出功能配置"></a>mindoc pdf 导出功能配置</h2><p>导出 pdf 格式文档使用的是<a href="https://wkhtmltopdf.org/downloads.html" title="wkhtmltopdf" target="_blank" rel="external">wkhtmltopdf</a></p>
<h3 id="下载对应稳定版本"><a href="#下载对应稳定版本" class="headerlink" title="下载对应稳定版本"></a>下载对应稳定版本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">wget https://github.com/wkhtmltopdf/wkhtmltopdf/releases/download/0.12.4/wkhtmltox-0.12.4_linux-generic-amd64.tar.xz</div><div class="line">xz -d wkhtmltox-0.12.4_linux-generic-amd64.tar.xz</div><div class="line">cp wkhtmltox-0.12.4_linux-generic-amd64.tar /data/</div><div class="line">tar -xvf wkhtmltox-0.12.4_linux-generic-amd64.tar</div><div class="line"><span class="built_in">cd</span> /data/wkhtmltox/</div></pre></td></tr></table></figure>
<h3 id="依赖包安装"><a href="#依赖包安装" class="headerlink" title="依赖包安装"></a>依赖包安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">yum install zlib</div><div class="line">yum install fontconfig</div><div class="line">yum install freetype </div><div class="line">yum install libX11</div><div class="line">yum install libXext</div><div class="line">yum install libXrender</div></pre></td></tr></table></figure>
<h3 id="验证生成pdf是否正常"><a href="#验证生成pdf是否正常" class="headerlink" title="验证生成pdf是否正常"></a>验证生成pdf是否正常</h3><p>可以访问外网，就拿百度做测试。无法访问外网，就随便拿个内网可以访问的url。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># cd /data/wkhtmltox/bin/</span></div><div class="line">./wkhtmltopdf www.baidu.com test.pdf  </div><div class="line">./wkhtmltopdf http://x.x.x.x/docs/mindoc/1  test.pdf</div></pre></td></tr></table></figure></p>
<p>下载test.pdf 用pdf软件打开查看是否正常</p>
<h3 id="pdf中文乱码解决"><a href="#pdf中文乱码解决" class="headerlink" title="pdf中文乱码解决"></a>pdf中文乱码解决</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">mkdir -p  /usr/share/fonts/chinese/TrueType/</div><div class="line"> ls -lrt</div><div class="line">总用量 14988</div><div class="line">-rw-r--r-- 1 root root 15323200 10月 17 09:54 simsun.ttc</div></pre></td></tr></table></figure>
<p>再将windows C:\Windows\Fonts下宋体传到该目录<br>重新验证测试，乱码解决。</p>
<h3 id="配置mindoc-pdf导出设置"><a href="#配置mindoc-pdf导出设置" class="headerlink" title="配置mindoc pdf导出设置"></a>配置mindoc pdf导出设置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /data/mindoc/</div><div class="line">cat conf/app.conf</div><div class="line"><span class="comment">###############配置PDF生成工具地址###################</span></div><div class="line">wkhtmltopdf=/data/wkhtmltox/bin/wkhtmltopdf</div><div class="line"></div><div class="line">systemctl restart  mindocd</div></pre></td></tr></table></figure>
<p>打开浏览器项目导出pdf，验证正常。</p>
<h2 id="效果图展示"><a href="#效果图展示" class="headerlink" title="效果图展示"></a>效果图展示</h2><h3 id="mindoc编辑效果图"><a href="#mindoc编辑效果图" class="headerlink" title="mindoc编辑效果图"></a>mindoc编辑效果图</h3><p>浏览器访问，左边编辑，右边及时预览就可以实时看到效果。编写语言按照markdown语法<br><img src="http://oy2fglccv.bkt.clouddn.com/mindoc.png" alt="mindoc编辑效果图"></p>
<h3 id="pdf导出效果"><a href="#pdf导出效果" class="headerlink" title="pdf导出效果"></a>pdf导出效果</h3><p><img src="http://oy2fglccv.bkt.clouddn.com/wkhtmltopdf.png" alt="htmltopdf导出效果图"></p>
<p>其他问题可参考  <a href="https://github.com/lifei6671/mindoc/wiki" title="mindoc 官方手册" target="_blank" rel="external">mindoc 官方手册</a></p>
]]></content>
      
        <categories>
            
            <category> 技术 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> mindoc </tag>
            
            <tag> 文档管理 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[搭建免费博客（上）]]></title>
      <url>/2017/10/20/bulid-blog-log-1/</url>
      <content type="html"><![CDATA[<h2 id="搭建过程"><a href="#搭建过程" class="headerlink" title="搭建过程"></a>搭建过程</h2><h3 id="github-帐号注册及仓库建立"><a href="#github-帐号注册及仓库建立" class="headerlink" title="github 帐号注册及仓库建立"></a>github 帐号注册及仓库建立</h3><h4 id="帐号注册"><a href="#帐号注册" class="headerlink" title="帐号注册"></a>帐号注册</h4><p>github官网: <a href="https://github.com/" target="_blank" rel="external">github</a></p>
<h4 id="创建仓库"><a href="#创建仓库" class="headerlink" title="创建仓库"></a>创建仓库</h4><p>仓库名是username.github.io  注意：username和github用户名一定要一致，这是用的是github 的博客空间<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">shanguanyunya/shanguanyunya.github.io</div></pre></td></tr></table></figure></p>
<h3 id="软件安装"><a href="#软件安装" class="headerlink" title="软件安装"></a>软件安装</h3><h4 id="linux-操作系统安装和yum-源配置（可以访问外网）"><a href="#linux-操作系统安装和yum-源配置（可以访问外网）" class="headerlink" title="linux 操作系统安装和yum 源配置（可以访问外网）"></a>linux 操作系统安装和yum 源配置（可以访问外网）</h4><h4 id="git-安装"><a href="#git-安装" class="headerlink" title="git 安装"></a>git 安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install  git  -y</div></pre></td></tr></table></figure>
<h4 id="node-js-安装"><a href="#node-js-安装" class="headerlink" title="node.js 安装"></a>node.js 安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">wget https://raw.github.com/creationix/nvm/master/install.sh</div><div class="line">sh install.sh</div></pre></td></tr></table></figure>
<p>重新登录一个新会话<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nvm install 4</div></pre></td></tr></table></figure></p>
<h4 id="hexo-安装"><a href="#hexo-安装" class="headerlink" title="hexo 安装"></a>hexo 安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install hexo-cli -g</div></pre></td></tr></table></figure>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><h4 id="博客文件夹创建"><a href="#博客文件夹创建" class="headerlink" title="博客文件夹创建"></a>博客文件夹创建</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mkdir /data/hexo/</div><div class="line"><span class="built_in">cd</span> /data/hexo/</div><div class="line">hexo init shanguanyunya.github.io</div></pre></td></tr></table></figure>
<h4 id="主题安装"><a href="#主题安装" class="headerlink" title="主题安装"></a>主题安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span>  /data/hexo/shanguanyunya.github.io</div><div class="line">git <span class="built_in">clone</span> https://github.com/iissnan/hexo-theme-next themes/next</div></pre></td></tr></table></figure>
<p>更多主题: <a href="https://hexo.io/themes/" target="_blank" rel="external">themes</a></p>
<h4 id="配置文件设置"><a href="#配置文件设置" class="headerlink" title="配置文件设置"></a>配置文件设置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cp _config.yml _config.yml.bak.20171017-1</div></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">title: shanguanyunya's blog</div><div class="line">author: yunya</div><div class="line">language: zh-Hans</div><div class="line"> </div><div class="line">theme: next</div><div class="line"> </div><div class="line">deploy:</div><div class="line">  type: git</div><div class="line">  repo: git@github.com:shanguanyunya/shanguanyunya.github.io.git</div></pre></td></tr></table></figure>
<p>说明:key value 冒号后面有空格，git repo 地址也可以用https的形式<a href="https://github.com/shanguanyunya/shanguanyunya.github.io.git" target="_blank" rel="external">https://github.com/shanguanyunya/shanguanyunya.github.io.git</a></p>
<h3 id="安装成功测试及发布"><a href="#安装成功测试及发布" class="headerlink" title="安装成功测试及发布"></a>安装成功测试及发布</h3><h4 id="本地测试验证"><a href="#本地测试验证" class="headerlink" title="本地测试验证"></a>本地测试验证</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hexo s -p  8080</div></pre></td></tr></table></figure>
<p>浏览器访问 <a href="https://localhost:8080" target="_blank" rel="external">https://localhost:8080</a></p>
<h4 id="发布"><a href="#发布" class="headerlink" title="发布"></a>发布</h4><p>发布工具安装<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install hexo-deployer-git --save</div></pre></td></tr></table></figure></p>
<p>发布到github<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hexo clean &amp;&amp; hexo g &amp;&amp; hexo d</div></pre></td></tr></table></figure></p>
<h3 id="进阶配置"><a href="#进阶配置" class="headerlink" title="进阶配置"></a>进阶配置</h3><h4 id="阅读统计"><a href="#阅读统计" class="headerlink" title="阅读统计"></a>阅读统计</h4><p>注册LeanCloud帐号 <a href="https://leancloud.cn/" target="_blank" rel="external">https://leancloud.cn/</a><br>参考: <a href="https://notes.wanghao.work/2015-10-21-%E4%B8%BANexT%E4%B8%BB%E9%A2%98%E6%B7%BB%E5%8A%A0%E6%96%87%E7%AB%A0%E9%98%85%E8%AF%BB%E9%87%8F%E7%BB%9F%E8%AE%A1%E5%8A%9F%E8%83%BD.html#%E9%85%8D%E7%BD%AELeanCloud" target="_blank" rel="external">notes.wanghao.work</a></p>
<p>修改配置文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /data/hexo/shanguanyunya.github.io/themes/next</div><div class="line"><span class="comment"># Show number of visitors to each article.</span></div><div class="line"><span class="comment"># You can visit https://leancloud.cn get AppID and AppKey.</span></div><div class="line">leancloud_visitors:</div><div class="line">  <span class="built_in">enable</span>: <span class="literal">true</span></div><div class="line">  app_id: xxxxxxxxxxxxxxxxxx</div><div class="line">  app_key: xxxxxxxxxxxxxxxxx</div></pre></td></tr></table></figure></p>
<h4 id="404公益页面"><a href="#404公益页面" class="headerlink" title="404公益页面"></a>404公益页面</h4><p>修改配置文件,打开404导航页<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">menu:</div><div class="line">  home: / || home</div><div class="line">  about: /about/ || user</div><div class="line">  <span class="comment">#tags: /tags/ || tags</span></div><div class="line">  <span class="comment">#categories: /categories/ || th</span></div><div class="line">  archives: /archives/ || archive</div><div class="line">  <span class="comment">#schedule: /schedule/ || calendar</span></div><div class="line">  <span class="comment">#sitemap: /sitemap.xml || sitemap</span></div><div class="line">  commonweal: /404/ || heartbeat</div></pre></td></tr></table></figure></p>
<p>创建404页面<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /data/hexo/shanguanyunya.github.io</div><div class="line">hexo new page <span class="string">"404"</span></div><div class="line"><span class="built_in">cd</span> <span class="built_in">source</span>/404/</div><div class="line">[root@<span class="built_in">test</span> 404]<span class="comment"># cat index.md </span></div><div class="line">---</div><div class="line">title: 404</div><div class="line">date: 2017-10-17 16:13:56</div><div class="line">---</div><div class="line"></div><div class="line">&lt;script <span class="built_in">type</span>=<span class="string">"text/javascript"</span> src=<span class="string">"//qzonestyle.gtimg.cn/qzone/hybrid/app/404/search_children.js"</span> charset=<span class="string">"utf-8"</span> homePageUrl=<span class="string">"https://shanguanyunya.github.io/"</span> homePageName=<span class="string">"回到我的主页"</span>&gt;&lt;/script&gt;</div></pre></td></tr></table></figure></p>
]]></content>
      
        <categories>
            
            <category> 技术 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 博客 </tag>
            
            <tag> 测试 </tag>
            
            <tag> 原创 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Hello World]]></title>
      <url>/2017/10/18/hello-world/</url>
      <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>
]]></content>
      
        <categories>
            
            <category> 博客 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 测试 </tag>
            
        </tags>
        
    </entry>
    
  
  
</search>
